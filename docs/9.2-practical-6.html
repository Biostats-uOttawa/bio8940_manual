<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>9.2 Practical | BIO8940 Advanced stats and Open Science</title>
  <meta name="description" content="Theory and practicals for BIO8940 course at the University of Ottawa" />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="9.2 Practical | BIO8940 Advanced stats and Open Science" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/images/missing.png" />
  <meta property="og:description" content="Theory and practicals for BIO8940 course at the University of Ottawa" />
  <meta name="github-repo" content="BIO8940-uOttawa/class_book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9.2 Practical | BIO8940 Advanced stats and Open Science" />
  
  <meta name="twitter:description" content="Theory and practicals for BIO8940 course at the University of Ottawa" />
  <meta name="twitter:image" content="/images/missing.png" />

<meta name="author" content="Julien Martin" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="9.1-lecture-8.html"/>
<link rel="next" href="10-beyond-p-0.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced stats and open science</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Note</a></li>
<li class="part"><span><b>I Open Science</b></span></li>
<li class="chapter" data-level="1" data-path="1-introduction-to-open-science.html"><a href="1-introduction-to-open-science.html"><i class="fa fa-check"></i><b>1</b> Introduction to open Science</a>
<ul>
<li class="chapter" data-level="1.1" data-path="1.1-why-do-we-need-it.html"><a href="1.1-why-do-we-need-it.html"><i class="fa fa-check"></i><b>1.1</b> Why do we need it?</a></li>
<li class="chapter" data-level="1.2" data-path="1.2-lecture.html"><a href="1.2-lecture.html"><i class="fa fa-check"></i><b>1.2</b> Lecture</a></li>
<li class="chapter" data-level="1.3" data-path="1.3-what-it-is.html"><a href="1.3-what-it-is.html"><i class="fa fa-check"></i><b>1.3</b> What it is?</a></li>
<li class="chapter" data-level="1.4" data-path="1.4-reproducible-code-and-analysis.html"><a href="1.4-reproducible-code-and-analysis.html"><i class="fa fa-check"></i><b>1.4</b> Reproducible code and analysis</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="2-introduction-to-rmarkdown.html"><a href="2-introduction-to-rmarkdown.html"><i class="fa fa-check"></i><b>2</b> Introduction to Rmarkdown</a>
<ul>
<li class="chapter" data-level="2.1" data-path="2.1-lecture-1.html"><a href="2.1-lecture-1.html"><i class="fa fa-check"></i><b>2.1</b> Lecture</a></li>
<li class="chapter" data-level="2.2" data-path="2.2-practical.html"><a href="2.2-practical.html"><i class="fa fa-check"></i><b>2.2</b> Practical</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="2.2-practical.html"><a href="2.2-practical.html#context"><i class="fa fa-check"></i><b>2.2.1</b> Context</a></li>
<li class="chapter" data-level="2.2.2" data-path="2.2-practical.html"><a href="2.2-practical.html#questions"><i class="fa fa-check"></i><b>2.2.2</b> Questions</a></li>
<li class="chapter" data-level="" data-path="2.2-practical.html"><a href="2.2-practical.html#example-of-output"><i class="fa fa-check"></i>Example of output</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-introduction-to-github-with-r.html"><a href="3-introduction-to-github-with-r.html"><i class="fa fa-check"></i><b>3</b> Introduction to github with R</a>
<ul>
<li class="chapter" data-level="3.1" data-path="3.1-lecture-2.html"><a href="3.1-lecture-2.html"><i class="fa fa-check"></i><b>3.1</b> Lecture</a></li>
<li class="chapter" data-level="3.2" data-path="3.2-git_practical.html"><a href="3.2-git_practical.html"><i class="fa fa-check"></i><b>3.2</b> Practical</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="3.2-git_practical.html"><a href="3.2-git_practical.html#context-1"><i class="fa fa-check"></i><b>3.2.1</b> Context</a></li>
<li class="chapter" data-level="3.2.2" data-path="3.2-git_practical.html"><a href="3.2-git_practical.html#information-of-the-data"><i class="fa fa-check"></i><b>3.2.2</b> Information of the data</a></li>
<li class="chapter" data-level="3.2.3" data-path="3.2-git_practical.html"><a href="3.2-git_practical.html#questions-1"><i class="fa fa-check"></i><b>3.2.3</b> Questions</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Statistics</b></span></li>
<li class="chapter" data-level="4" data-path="4-generalized-linear-model-glm.html"><a href="4-generalized-linear-model-glm.html"><i class="fa fa-check"></i><b>4</b> Generalized linear model, <code>glm</code></a>
<ul>
<li class="chapter" data-level="4.1" data-path="4.1-lecture-3.html"><a href="4.1-lecture-3.html"><i class="fa fa-check"></i><b>4.1</b> Lecture</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="4.1-lecture-3.html"><a href="4.1-lecture-3.html#distributions"><i class="fa fa-check"></i><b>4.1.1</b> Distributions</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="4.2-practical-1.html"><a href="4.2-practical-1.html"><i class="fa fa-check"></i><b>4.2</b> Practical</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="4.2-practical-1.html"><a href="4.2-practical-1.html#logistic-regression"><i class="fa fa-check"></i><b>4.2.1</b> Logistic regression</a></li>
<li class="chapter" data-level="4.2.2" data-path="4.2-practical-1.html"><a href="4.2-practical-1.html#poisson-regression"><i class="fa fa-check"></i><b>4.2.2</b> Poisson regression</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="5-introduction-to-linear-mixed-models.html"><a href="5-introduction-to-linear-mixed-models.html"><i class="fa fa-check"></i><b>5</b> Introduction to linear mixed models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="5.1-lecture-4.html"><a href="5.1-lecture-4.html"><i class="fa fa-check"></i><b>5.1</b> Lecture</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="5.1-lecture-4.html"><a href="5.1-lecture-4.html#testing-fixed-effects"><i class="fa fa-check"></i><b>5.1.1</b> Testing fixed effects</a></li>
<li class="chapter" data-level="5.1.2" data-path="5.1-lecture-4.html"><a href="5.1-lecture-4.html#shrinkage"><i class="fa fa-check"></i><b>5.1.2</b> Shrinkage</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="5.2-practical-2.html"><a href="5.2-practical-2.html"><i class="fa fa-check"></i><b>5.2</b> Practical</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="5.2-practical-2.html"><a href="5.2-practical-2.html#overview"><i class="fa fa-check"></i><b>5.2.1</b> Overview</a></li>
<li class="chapter" data-level="5.2.2" data-path="5.2-practical-2.html"><a href="5.2-practical-2.html#r-packages-needed"><i class="fa fa-check"></i><b>5.2.2</b> R packages needed</a></li>
<li class="chapter" data-level="5.2.3" data-path="5.2-practical-2.html"><a href="5.2-practical-2.html#the-superb-wild-unicorns-of-the-scottish-highlands"><i class="fa fa-check"></i><b>5.2.3</b> The superb wild unicorns of the Scottish Highlands</a></li>
<li class="chapter" data-level="5.2.4" data-path="5.2-practical-2.html"><a href="5.2-practical-2.html#do-unicorns-differ-in-aggressiveness-your-first-mixed-model"><i class="fa fa-check"></i><b>5.2.4</b> Do unicorns differ in aggressiveness? Your first mixed model</a></li>
<li class="chapter" data-level="5.2.5" data-path="5.2-practical-2.html"><a href="5.2-practical-2.html#do-unicorns-differ-in-aggressiveness-a-better-mixed-model"><i class="fa fa-check"></i><b>5.2.5</b> Do unicorns differ in aggressiveness? A better mixed model</a></li>
<li class="chapter" data-level="5.2.6" data-path="5.2-practical-2.html"><a href="5.2-practical-2.html#what-is-the-repeatability"><i class="fa fa-check"></i><b>5.2.6</b> What is the repeatability?</a></li>
<li class="chapter" data-level="5.2.7" data-path="5.2-practical-2.html"><a href="5.2-practical-2.html#a-quick-note-on-uncertainty"><i class="fa fa-check"></i><b>5.2.7</b> A quick note on uncertainty</a></li>
<li class="chapter" data-level="5.2.8" data-path="5.2-practical-2.html"><a href="5.2-practical-2.html#an-easy-way-to-mess-up-your-mixed-models"><i class="fa fa-check"></i><b>5.2.8</b> An easy way to mess up your mixed models</a></li>
<li class="chapter" data-level="5.2.9" data-path="5.2-practical-2.html"><a href="5.2-practical-2.html#happy-mixed-modelling"><i class="fa fa-check"></i><b>5.2.9</b> Happy mixed-modelling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="6-introduction-to-glmm.html"><a href="6-introduction-to-glmm.html"><i class="fa fa-check"></i><b>6</b> Introduction to <code>GLMM</code></a>
<ul>
<li class="chapter" data-level="6.1" data-path="6.1-lecture-5.html"><a href="6.1-lecture-5.html"><i class="fa fa-check"></i><b>6.1</b> Lecture</a></li>
<li class="chapter" data-level="6.2" data-path="6.2-practical-3.html"><a href="6.2-practical-3.html"><i class="fa fa-check"></i><b>6.2</b> Practical</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="6.2-practical-3.html"><a href="6.2-practical-3.html#packages-and-functions"><i class="fa fa-check"></i><b>6.2.1</b> Packages and functions</a></li>
<li class="chapter" data-level="6.2.2" data-path="6.2-practical-3.html"><a href="6.2-practical-3.html#the-data-set"><i class="fa fa-check"></i><b>6.2.2</b> The data set</a></li>
<li class="chapter" data-level="6.2.3" data-path="6.2-practical-3.html"><a href="6.2-practical-3.html#specifying-fixed-and-random-effects"><i class="fa fa-check"></i><b>6.2.3</b> Specifying fixed and random Effects</a></li>
<li class="chapter" data-level="6.2.4" data-path="6.2-practical-3.html"><a href="6.2-practical-3.html#look-at-overall-patterns-in-data"><i class="fa fa-check"></i><b>6.2.4</b> Look at overall patterns in data</a></li>
<li class="chapter" data-level="6.2.5" data-path="6.2-practical-3.html"><a href="6.2-practical-3.html#choose-an-error-distribution"><i class="fa fa-check"></i><b>6.2.5</b> Choose an error distribution</a></li>
<li class="chapter" data-level="6.2.6" data-path="6.2-practical-3.html"><a href="6.2-practical-3.html#fitting-group-wise-glm"><i class="fa fa-check"></i><b>6.2.6</b> Fitting group-wise GLM</a></li>
<li class="chapter" data-level="6.2.7" data-path="6.2-practical-3.html"><a href="6.2-practical-3.html#fitting-and-evaluating-glmms"><i class="fa fa-check"></i><b>6.2.7</b> Fitting and evaluating GLMMs</a></li>
<li class="chapter" data-level="6.2.8" data-path="6.2-practical-3.html"><a href="6.2-practical-3.html#inference"><i class="fa fa-check"></i><b>6.2.8</b> Inference</a></li>
<li class="chapter" data-level="6.2.9" data-path="6.2-practical-3.html"><a href="6.2-practical-3.html#conclusions"><i class="fa fa-check"></i><b>6.2.9</b> Conclusions</a></li>
<li class="chapter" data-level="6.2.10" data-path="6.2-practical-3.html"><a href="6.2-practical-3.html#happy-generalized-mixed-modelling"><i class="fa fa-check"></i><b>6.2.10</b> Happy generalized mixed-modelling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="7-introduction-to-bayesian-inference.html"><a href="7-introduction-to-bayesian-inference.html"><i class="fa fa-check"></i><b>7</b> Introduction to <code>Bayesian Inference</code></a>
<ul>
<li class="chapter" data-level="7.1" data-path="7.1-lecture-6.html"><a href="7.1-lecture-6.html"><i class="fa fa-check"></i><b>7.1</b> Lecture</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="7.1-lecture-6.html"><a href="7.1-lecture-6.html#bayes-theorem"><i class="fa fa-check"></i><b>7.1.1</b> Bayes’ theorem</a></li>
<li class="chapter" data-level="7.1.2" data-path="7.1-lecture-6.html"><a href="7.1-lecture-6.html#intro-to-mcmc"><i class="fa fa-check"></i><b>7.1.2</b> Intro to MCMC</a></li>
<li class="chapter" data-level="7.1.3" data-path="7.1-lecture-6.html"><a href="7.1-lecture-6.html#inferences-1"><i class="fa fa-check"></i><b>7.1.3</b> Inferences</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="7.2-practical-4.html"><a href="7.2-practical-4.html"><i class="fa fa-check"></i><b>7.2</b> Practical</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="7.2-practical-4.html"><a href="7.2-practical-4.html#r-packages-needed-1"><i class="fa fa-check"></i><b>7.2.1</b> R packages needed</a></li>
<li class="chapter" data-level="7.2.2" data-path="7.2-practical-4.html"><a href="7.2-practical-4.html#a-refresher-on-unicorn-ecology"><i class="fa fa-check"></i><b>7.2.2</b> A refresher on unicorn ecology</a></li>
<li class="chapter" data-level="7.2.3" data-path="7.2-practical-4.html"><a href="7.2-practical-4.html#mcmcglmm"><i class="fa fa-check"></i><b>7.2.3</b> MCMCglmm</a></li>
<li class="chapter" data-level="7.2.4" data-path="7.2-practical-4.html"><a href="7.2-practical-4.html#inferences-2"><i class="fa fa-check"></i><b>7.2.4</b> Inferences</a></li>
<li class="chapter" data-level="7.2.5" data-path="7.2-practical-4.html"><a href="7.2-practical-4.html#brms"><i class="fa fa-check"></i><b>7.2.5</b> brms</a></li>
<li class="chapter" data-level="7.2.6" data-path="7.2-practical-4.html"><a href="7.2-practical-4.html#inferences-3"><i class="fa fa-check"></i><b>7.2.6</b> Inferences</a></li>
<li class="chapter" data-level="7.2.7" data-path="7.2-practical-4.html"><a href="7.2-practical-4.html#happy-bayesian-stats"><i class="fa fa-check"></i><b>7.2.7</b> Happy Bayesian stats</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="8-multivariate-mixed-models.html"><a href="8-multivariate-mixed-models.html"><i class="fa fa-check"></i><b>8</b> Multivariate mixed models</a>
<ul>
<li class="chapter" data-level="8.1" data-path="8.1-lecture-7.html"><a href="8.1-lecture-7.html"><i class="fa fa-check"></i><b>8.1</b> Lecture</a></li>
<li class="chapter" data-level="8.2" data-path="8.2-practical-5.html"><a href="8.2-practical-5.html"><i class="fa fa-check"></i><b>8.2</b> Practical</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="8.2-practical-5.html"><a href="8.2-practical-5.html#r-packages-needed-2"><i class="fa fa-check"></i><b>8.2.1</b> R packages needed</a></li>
<li class="chapter" data-level="8.2.2" data-path="8.2-practical-5.html"><a href="8.2-practical-5.html#the-blue-dragon-of-the-east"><i class="fa fa-check"></i><b>8.2.2</b> The blue dragon of the East</a></li>
<li class="chapter" data-level="8.2.3" data-path="8.2-practical-5.html"><a href="8.2-practical-5.html#multiple-univariate-models"><i class="fa fa-check"></i><b>8.2.3</b> Multiple univariate models</a></li>
<li class="chapter" data-level="8.2.4" data-path="8.2-practical-5.html"><a href="8.2-practical-5.html#multivariate-approach"><i class="fa fa-check"></i><b>8.2.4</b> Multivariate approach</a></li>
<li class="chapter" data-level="8.2.5" data-path="8.2-practical-5.html"><a href="8.2-practical-5.html#happy-multivariate-models"><i class="fa fa-check"></i><b>8.2.5</b> Happy multivariate models</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="9-random-regression-and-character-state-approaches.html"><a href="9-random-regression-and-character-state-approaches.html"><i class="fa fa-check"></i><b>9</b> Random regression and character state approaches</a>
<ul>
<li class="chapter" data-level="9.1" data-path="9.1-lecture-8.html"><a href="9.1-lecture-8.html"><i class="fa fa-check"></i><b>9.1</b> Lecture</a></li>
<li class="chapter" data-level="9.2" data-path="9.2-practical-6.html"><a href="9.2-practical-6.html"><i class="fa fa-check"></i><b>9.2</b> Practical</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="9.2-practical-6.html"><a href="9.2-practical-6.html#r-packages-needed-3"><i class="fa fa-check"></i><b>9.2.1</b> R packages needed</a></li>
<li class="chapter" data-level="9.2.2" data-path="9.2-practical-6.html"><a href="9.2-practical-6.html#refresher-on-unicorn-aggression"><i class="fa fa-check"></i><b>9.2.2</b> Refresher on unicorn aggression</a></li>
<li class="chapter" data-level="9.2.3" data-path="9.2-practical-6.html"><a href="9.2-practical-6.html#random-regression"><i class="fa fa-check"></i><b>9.2.3</b> Random regression</a></li>
<li class="chapter" data-level="9.2.4" data-path="9.2-practical-6.html"><a href="9.2-practical-6.html#character-state-approach"><i class="fa fa-check"></i><b>9.2.4</b> Character-State approach</a></li>
<li class="chapter" data-level="9.2.5" data-path="9.2-practical-6.html"><a href="9.2-practical-6.html#from-random-regression-to-character-state"><i class="fa fa-check"></i><b>9.2.5</b> From random regression to character-state</a></li>
<li class="chapter" data-level="9.2.6" data-path="9.2-practical-6.html"><a href="9.2-practical-6.html#conclusions-2"><i class="fa fa-check"></i><b>9.2.6</b> Conclusions</a></li>
<li class="chapter" data-level="9.2.7" data-path="9.2-practical-6.html"><a href="9.2-practical-6.html#happy-multivariate-models-1"><i class="fa fa-check"></i><b>9.2.7</b> Happy multivariate models</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="10-beyond-p-0.html"><a href="10-beyond-p-0.html"><i class="fa fa-check"></i><b>10</b> Beyond <em>P &lt; 0.05</em></a></li>
<li class="chapter" data-level="11" data-path="11-pca.html"><a href="11-pca.html"><i class="fa fa-check"></i><b>11</b> PCA</a>
<ul>
<li class="chapter" data-level="11.1" data-path="11.1-lecture-9.html"><a href="11.1-lecture-9.html"><i class="fa fa-check"></i><b>11.1</b> Lecture</a></li>
<li class="chapter" data-level="11.2" data-path="11.2-practical-7.html"><a href="11.2-practical-7.html"><i class="fa fa-check"></i><b>11.2</b> Practical</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="12-coordinates.html"><a href="12-coordinates.html"><i class="fa fa-check"></i><b>12</b> Coordinates</a></li>
<li class="chapter" data-level="13" data-path="13-coordinates-of-variables.html"><a href="13-coordinates-of-variables.html"><i class="fa fa-check"></i><b>13</b> Coordinates of variables</a></li>
<li class="chapter" data-level="14" data-path="14-total-cos2-of-variables-on-dim.1-and-dim.html"><a href="14-total-cos2-of-variables-on-dim.1-and-dim.html"><i class="fa fa-check"></i><b>14</b> Total cos2 of variables on Dim.1 and Dim.2</a></li>
<li class="chapter" data-level="15" data-path="15-color-by-cos2-values-quality-on-the-factor-map.html"><a href="15-color-by-cos2-values-quality-on-the-factor-map.html"><i class="fa fa-check"></i><b>15</b> Color by cos2 values: quality on the factor map</a></li>
<li class="chapter" data-level="16" data-path="16-change-the-transparency-by-cos2-values.html"><a href="16-change-the-transparency-by-cos2-values.html"><i class="fa fa-check"></i><b>16</b> Change the transparency by cos2 values</a></li>
<li class="chapter" data-level="17" data-path="17-contributions-of-variables-to-pc1.html"><a href="17-contributions-of-variables-to-pc1.html"><i class="fa fa-check"></i><b>17</b> Contributions of variables to PC1</a></li>
<li class="chapter" data-level="18" data-path="18-change-the-transparency-by-contrib-values.html"><a href="18-change-the-transparency-by-contrib-values.html"><i class="fa fa-check"></i><b>18</b> Change the transparency by contrib values</a></li>
<li class="chapter" data-level="19" data-path="19-create-a-random-continuous-variable-of-length-10.html"><a href="19-create-a-random-continuous-variable-of-length-10.html"><i class="fa fa-check"></i><b>19</b> Create a random continuous variable of length 10</a></li>
<li class="chapter" data-level="20" data-path="20-create-a-grouping-variable-using-kmeans.html"><a href="20-create-a-grouping-variable-using-kmeans.html"><i class="fa fa-check"></i><b>20</b> Create a grouping variable using kmeans</a></li>
<li class="chapter" data-level="21" data-path="21-create-3-groups-of-variables-centers-3.html"><a href="21-create-3-groups-of-variables-centers-3.html"><i class="fa fa-check"></i><b>21</b> Create 3 groups of variables (centers = 3)</a>
<ul>
<li class="chapter" data-level="21.1" data-path="21.1-principal-component-analysis-results-for-individuals.html"><a href="21.1-principal-component-analysis-results-for-individuals.html"><i class="fa fa-check"></i><b>21.1</b> Principal Component Analysis Results for individuals</a></li>
<li class="chapter" data-level="21.2" data-path="21.2-section.html"><a href="21.2-section.html"><i class="fa fa-check"></i><b>21.2</b> ===================================================</a></li>
<li class="chapter" data-level="21.3" data-path="21.3-name-description.html"><a href="21.3-name-description.html"><i class="fa fa-check"></i><b>21.3</b> Name Description</a></li>
<li class="chapter" data-level="21.4" data-path="21.4-coord-coordinates-for-the-individuals-2-cos2-cos2-for-the-individuals.html"><a href="21.4-coord-coordinates-for-the-individuals-2-cos2-cos2-for-the-individuals.html"><i class="fa fa-check"></i><b>21.4</b> 1 “<span class="math inline">\(coord&quot; &quot;Coordinates for the individuals&quot; ## 2 &quot;\)</span>cos2” “Cos2 for the individuals”</a></li>
<li class="chapter" data-level="21.5" data-path="21.5-contrib-contributions-of-the-individuals.html"><a href="21.5-contrib-contributions-of-the-individuals.html"><i class="fa fa-check"></i><b>21.5</b> 3 “$contrib” “contributions of the individuals”</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="22-coordinates-of-individuals.html"><a href="22-coordinates-of-individuals.html"><i class="fa fa-check"></i><b>22</b> Coordinates of individuals</a></li>
<li class="chapter" data-level="23" data-path="23-total-contribution-on-pc1-and-pc2.html"><a href="23-total-contribution-on-pc1-and-pc2.html"><i class="fa fa-check"></i><b>23</b> Total contribution on PC1 and PC2</a></li>
<li class="chapter" data-level="24" data-path="24-create-a-random-continuous-variable-of-length-23.html"><a href="24-create-a-random-continuous-variable-of-length-23.html"><i class="fa fa-check"></i><b>24</b> Create a random continuous variable of length 23,</a></li>
<li class="chapter" data-level="25" data-path="25-same-length-as-the-number-of-active-individuals-in-the-pca.html"><a href="25-same-length-as-the-number-of-active-individuals-in-the-pca.html"><i class="fa fa-check"></i><b>25</b> Same length as the number of active individuals in the PCA</a>
<ul>
<li class="chapter" data-level="25.1" data-path="25.1-sepal.length-sepal.width-petal.length-petal.width-species.html"><a href="25.1-sepal.length-sepal.width-petal.length-petal.width-species.html"><i class="fa fa-check"></i><b>25.1</b> Sepal.Length Sepal.Width Petal.Length Petal.Width Species</a></li>
<li class="chapter" data-level="25.2" data-path="25.2-setosa.html"><a href="25.2-setosa.html"><i class="fa fa-check"></i><b>25.2</b> 1 5.1 3.5 1.4 0.2 setosa</a></li>
<li class="chapter" data-level="25.3" data-path="25.3-setosa-1.html"><a href="25.3-setosa-1.html"><i class="fa fa-check"></i><b>25.3</b> 2 4.9 3.0 1.4 0.2 setosa</a></li>
<li class="chapter" data-level="25.4" data-path="25.4-setosa-2.html"><a href="25.4-setosa-2.html"><i class="fa fa-check"></i><b>25.4</b> 3 4.7 3.2 1.3 0.2 setosa</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="26-the-variable-species-index-5-is-removed.html"><a href="26-the-variable-species-index-5-is-removed.html"><i class="fa fa-check"></i><b>26</b> The variable Species (index = 5) is removed</a></li>
<li class="chapter" data-level="27" data-path="27-before-pca-analysis.html"><a href="27-before-pca-analysis.html"><i class="fa fa-check"></i><b>27</b> before PCA analysis</a></li>
<li class="chapter" data-level="28" data-path="28-add-confidence-ellipses.html"><a href="28-add-confidence-ellipses.html"><i class="fa fa-check"></i><b>28</b> Add confidence ellipses</a></li>
<li class="chapter" data-level="29" data-path="29-variables-on-dimensions-2-and-3.html"><a href="29-variables-on-dimensions-2-and-3.html"><i class="fa fa-check"></i><b>29</b> Variables on dimensions 2 and 3</a></li>
<li class="chapter" data-level="30" data-path="30-show-variable-points-and-text-labels.html"><a href="30-show-variable-points-and-text-labels.html"><i class="fa fa-check"></i><b>30</b> Show variable points and text labels</a></li>
<li class="chapter" data-level="31" data-path="31-show-individuals-text-labels-only.html"><a href="31-show-individuals-text-labels-only.html"><i class="fa fa-check"></i><b>31</b> Show individuals text labels only</a></li>
<li class="chapter" data-level="32" data-path="32-change-the-size-of-arrows-an-labels.html"><a href="32-change-the-size-of-arrows-an-labels.html"><i class="fa fa-check"></i><b>32</b> Change the size of arrows an labels</a></li>
<li class="chapter" data-level="33" data-path="33-add-confidence-ellipses-1.html"><a href="33-add-confidence-ellipses-1.html"><i class="fa fa-check"></i><b>33</b> Add confidence ellipses</a>
<ul>
<li class="chapter" data-level="33.1" data-path="33.1-coord.html"><a href="33.1-coord.html"><i class="fa fa-check"></i><b>33.1</b> $coord</a></li>
<li class="chapter" data-level="33.2" data-path="33.2-dim.1-dim.2-dim.3-dim.4-dim.html"><a href="33.2-dim.1-dim.2-dim.3-dim.4-dim.html"><i class="fa fa-check"></i><b>33.2</b> Dim.1 Dim.2 Dim.3 Dim.4 Dim.5</a></li>
<li class="chapter" data-level="33.3" data-path="33.3-rank--0.701--0.2452--0.183-0.0558--0.html"><a href="33.3-rank--0.701--0.2452--0.183-0.0558--0.html"><i class="fa fa-check"></i><b>33.3</b> Rank -0.701 -0.2452 -0.183 0.0558 -0.0738</a></li>
<li class="chapter" data-level="33.4" data-path="33.4-points-0.964-0.0777-0.158--0.1662--0.html"><a href="33.4-points-0.964-0.0777-0.158--0.1662--0.html"><i class="fa fa-check"></i><b>33.4</b> Points 0.964 0.0777 0.158 -0.1662 -0.0311</a></li>
<li class="chapter" data-level="33.5" data-path="33.5-section-1.html"><a href="33.5-section-1.html"><i class="fa fa-check"></i><b>33.5</b> </a></li>
<li class="chapter" data-level="33.6" data-path="33.6-cor.html"><a href="33.6-cor.html"><i class="fa fa-check"></i><b>33.6</b> $cor</a></li>
<li class="chapter" data-level="33.7" data-path="33.7-dim.1-dim.2-dim.3-dim.4-dim.5-1.html"><a href="33.7-dim.1-dim.2-dim.3-dim.4-dim.5-1.html"><i class="fa fa-check"></i><b>33.7</b> Dim.1 Dim.2 Dim.3 Dim.4 Dim.5</a></li>
<li class="chapter" data-level="33.8" data-path="33.8-rank--0.701--0.2452--0.183-0.0558--0.0738-1.html"><a href="33.8-rank--0.701--0.2452--0.183-0.0558--0.0738-1.html"><i class="fa fa-check"></i><b>33.8</b> Rank -0.701 -0.2452 -0.183 0.0558 -0.0738</a></li>
<li class="chapter" data-level="33.9" data-path="33.9-points-0.964-0.0777-0.158--0.1662--0.0311-1.html"><a href="33.9-points-0.964-0.0777-0.158--0.1662--0.0311-1.html"><i class="fa fa-check"></i><b>33.9</b> Points 0.964 0.0777 0.158 -0.1662 -0.0311</a></li>
<li class="chapter" data-level="33.10" data-path="33.10-section-2.html"><a href="33.10-section-2.html"><i class="fa fa-check"></i><b>33.10</b> </a></li>
<li class="chapter" data-level="33.11" data-path="33.11-cos2.html"><a href="33.11-cos2.html"><i class="fa fa-check"></i><b>33.11</b> $cos2</a></li>
<li class="chapter" data-level="33.12" data-path="33.12-dim.1-dim.2-dim.3-dim.4-dim.5-2.html"><a href="33.12-dim.1-dim.2-dim.3-dim.4-dim.5-2.html"><i class="fa fa-check"></i><b>33.12</b> Dim.1 Dim.2 Dim.3 Dim.4 Dim.5</a></li>
<li class="chapter" data-level="33.13" data-path="33.13-rank-0.492-0.06012-0.0336-0.00311-0.html"><a href="33.13-rank-0.492-0.06012-0.0336-0.00311-0.html"><i class="fa fa-check"></i><b>33.13</b> Rank 0.492 0.06012 0.0336 0.00311 0.00545</a></li>
<li class="chapter" data-level="33.14" data-path="33.14-points-0.929-0.00603-0.0250-0.02763-0.html"><a href="33.14-points-0.929-0.00603-0.0250-0.02763-0.html"><i class="fa fa-check"></i><b>33.14</b> Points 0.929 0.00603 0.0250 0.02763 0.00097</a></li>
</ul></li>
<li class="chapter" data-level="34" data-path="34-change-color-of-variables.html"><a href="34-change-color-of-variables.html"><i class="fa fa-check"></i><b>34</b> Change color of variables</a></li>
<li class="chapter" data-level="35" data-path="35-plot-of-active-variables.html"><a href="35-plot-of-active-variables.html"><i class="fa fa-check"></i><b>35</b> Plot of active variables</a></li>
<li class="chapter" data-level="36" data-path="36-visualize-variable-with-cos2-0.html"><a href="36-visualize-variable-with-cos2-0.html"><i class="fa fa-check"></i><b>36</b> Visualize variable with cos2 &gt;= 0.6</a></li>
<li class="chapter" data-level="37" data-path="37-print-the-plot-to-a-pdf-file.html"><a href="37-print-the-plot-to-a-pdf-file.html"><i class="fa fa-check"></i><b>37</b> Print the plot to a pdf file</a></li>
<li class="chapter" data-level="38" data-path="38-scree-plot.html"><a href="38-scree-plot.html"><i class="fa fa-check"></i><b>38</b> Scree plot</a></li>
<li class="chapter" data-level="39" data-path="39-print-scree-plot-to-a-png-file.html"><a href="39-print-scree-plot-to-a-png-file.html"><i class="fa fa-check"></i><b>39</b> Print scree plot to a png file</a></li>
<li class="chapter" data-level="40" data-path="40-export-into-a-txt-file.html"><a href="40-export-into-a-txt-file.html"><i class="fa fa-check"></i><b>40</b> Export into a TXT file</a></li>
<li class="part"><span><b>III Appendix</b></span></li>
<li class="chapter" data-level="" data-path="r.html"><a href="r.html"><i class="fa fa-check"></i>R</a></li>
<li class="chapter" data-level="" data-path="to-do-list.html"><a href="to-do-list.html"><i class="fa fa-check"></i>To do list</a>
<ul>
<li class="chapter" data-level="40.1" data-path="40.1-potential-structure.html"><a href="40.1-potential-structure.html"><i class="fa fa-check"></i><b>40.1</b> potential structure</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="_blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">BIO8940 Advanced stats and Open Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="practical-6" class="section level2 hasAnchor" number="9.2">
<h2><span class="header-section-number">9.2</span> Practical<a href="9.2-practical-6.html#practical-6" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this practical, we will revisit our analysis on unicorn aggressivity.
Honestly, we can use any other data with repeated measures for this exercise
but I just ❤️ unicorns.</p>
<div id="r-packages-needed-3" class="section level3 hasAnchor" number="9.2.1">
<h3><span class="header-section-number">9.2.1</span> R packages needed<a href="9.2-practical-6.html#r-packages-needed-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>First we load required libraries</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="9.2-practical-6.html#cb314-1" aria-hidden="true"></a><span class="kw">library</span>(lme4)</span>
<span id="cb314-2"><a href="9.2-practical-6.html#cb314-2" aria-hidden="true"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb314-3"><a href="9.2-practical-6.html#cb314-3" aria-hidden="true"></a><span class="kw">library</span>(broom.mixed)</span>
<span id="cb314-4"><a href="9.2-practical-6.html#cb314-4" aria-hidden="true"></a><span class="kw">library</span>(asreml)</span>
<span id="cb314-5"><a href="9.2-practical-6.html#cb314-5" aria-hidden="true"></a><span class="kw">library</span>(MCMCglmm)</span>
<span id="cb314-6"><a href="9.2-practical-6.html#cb314-6" aria-hidden="true"></a><span class="kw">library</span>(bayesplot)</span></code></pre></div>
</div>
<div id="refresher-on-unicorn-aggression" class="section level3 hasAnchor" number="9.2.2">
<h3><span class="header-section-number">9.2.2</span> Refresher on unicorn aggression<a href="9.2-practical-6.html#refresher-on-unicorn-aggression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the previous, practical on linear mixed models, we simply explored the differences among individuals in their mean aggression (Intercept), but we assumed that the response to the change in aggression with the opponent size (i.e. plasticity) was the same for all individuals. However, this plastic responses can also vary amon individuals. This is called IxE, or individual by environment interaction. To test if individuals differ in their plasticity we can use a random regression, whcih is simply a mixed-model where we fit both a random intercept and a random slope effect.</p>
<p>Following analysis from the previous pratical, our model of interest using scaled covariate was:</p>
<pre><code>aggression ~ opp_size + body_size_sc + assay_rep_sc + block
              + (1 | ID)</code></pre>
<p>We should start by loading the data and refitting the model using <code>lmer()</code>.</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="9.2-practical-6.html#cb316-1" aria-hidden="true"></a>unicorns &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/unicorns_aggression.csv&quot;</span>)</span>
<span id="cb316-2"><a href="9.2-practical-6.html#cb316-2" aria-hidden="true"></a>unicorns &lt;-<span class="st"> </span>unicorns <span class="op">%&gt;%</span></span>
<span id="cb316-3"><a href="9.2-practical-6.html#cb316-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb316-4"><a href="9.2-practical-6.html#cb316-4" aria-hidden="true"></a>    <span class="dt">body_size_sc =</span> <span class="kw">scale</span>(body_size),</span>
<span id="cb316-5"><a href="9.2-practical-6.html#cb316-5" aria-hidden="true"></a>    <span class="dt">assay_rep_sc =</span> <span class="kw">scale</span>(assay_rep, <span class="dt">scale =</span> <span class="ot">FALSE</span>)</span>
<span id="cb316-6"><a href="9.2-practical-6.html#cb316-6" aria-hidden="true"></a>  )</span>
<span id="cb316-7"><a href="9.2-practical-6.html#cb316-7" aria-hidden="true"></a></span>
<span id="cb316-8"><a href="9.2-practical-6.html#cb316-8" aria-hidden="true"></a>m_mer &lt;-<span class="st"> </span><span class="kw">lmer</span>(</span>
<span id="cb316-9"><a href="9.2-practical-6.html#cb316-9" aria-hidden="true"></a>    aggression <span class="op">~</span><span class="st"> </span>opp_size <span class="op">+</span><span class="st"> </span>body_size_sc <span class="op">+</span><span class="st"> </span>assay_rep_sc <span class="op">+</span><span class="st"> </span>block</span>
<span id="cb316-10"><a href="9.2-practical-6.html#cb316-10" aria-hidden="true"></a>      <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>ID),</span>
<span id="cb316-11"><a href="9.2-practical-6.html#cb316-11" aria-hidden="true"></a>    <span class="dt">data =</span> unicorns</span>
<span id="cb316-12"><a href="9.2-practical-6.html#cb316-12" aria-hidden="true"></a>)</span>
<span id="cb316-13"><a href="9.2-practical-6.html#cb316-13" aria-hidden="true"></a><span class="kw">summary</span>(m_mer)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML. t-tests use Satterthwaite&#39;s method [&#39;lmerModLmerTest&#39;]
## Formula: aggression ~ opp_size + body_size_sc + assay_rep_sc + block +      (1 | ID)
##    Data: unicorns
## 
## REML criterion at convergence: 1136.5
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -2.85473 -0.62831  0.02545  0.68998  2.74064 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  ID       (Intercept) 0.02538  0.1593  
##  Residual             0.58048  0.7619  
## Number of obs: 480, groups:  ID, 80
## 
## Fixed effects:
##               Estimate Std. Error        df t value Pr(&gt;|t|)    
## (Intercept)    9.00181    0.03907  78.07315 230.395   &lt;2e-16 ***
## opp_size       1.05141    0.04281 396.99857  24.562   &lt;2e-16 ***
## body_size_sc   0.03310    0.03896  84.21144   0.850    0.398    
## assay_rep_sc  -0.05783    0.04281 396.99857  -1.351    0.177    
## block         -0.02166    0.06955 397.00209  -0.311    0.756    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##             (Intr) opp_sz bdy_s_ assy__
## opp_size     0.000                     
## body_siz_sc  0.000  0.000              
## assay_rp_sc  0.000 -0.100  0.000       
## block        0.000  0.000  0.002  0.000</code></pre>
<p>We can now plot the predictions for each of our observations and plot for the observed and the fitted data for each individuals. Todo so we will use the <code>augment()</code> function from the 📦 <code>broom.mixed</code>.</p>
<p>Below, we plot the raw data for each individual in one panel, with the fitted slopes in a second panel. Because
we have 2 blocks of data, and block is fitted as a fixed effect, for ease of presentation we need to either select only 1 block for representation, take teh avaerage over the block effect or do a more complex graph with the two blocks. Here I have selected only one of the blocks for this plot</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="9.2-practical-6.html#cb318-1" aria-hidden="true"></a>pred_m_mer &lt;-<span class="st"> </span><span class="kw">augment</span>(m_mer) <span class="op">%&gt;%</span></span>
<span id="cb318-2"><a href="9.2-practical-6.html#cb318-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(ID, block, opp_size, .fitted, aggression) <span class="op">%&gt;%</span></span>
<span id="cb318-3"><a href="9.2-practical-6.html#cb318-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(block <span class="op">==</span><span class="st"> </span><span class="fl">-0.5</span>) <span class="op">%&gt;%</span></span>
<span id="cb318-4"><a href="9.2-practical-6.html#cb318-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">gather</span>(</span>
<span id="cb318-5"><a href="9.2-practical-6.html#cb318-5" aria-hidden="true"></a>    type, aggression,</span>
<span id="cb318-6"><a href="9.2-practical-6.html#cb318-6" aria-hidden="true"></a>    <span class="st">`</span><span class="dt">.fitted</span><span class="st">`</span><span class="op">:</span>aggression</span>
<span id="cb318-7"><a href="9.2-practical-6.html#cb318-7" aria-hidden="true"></a>  )</span>
<span id="cb318-8"><a href="9.2-practical-6.html#cb318-8" aria-hidden="true"></a><span class="kw">ggplot</span>(pred_m_mer, <span class="kw">aes</span>(<span class="dt">x =</span> opp_size, <span class="dt">y =</span> aggression, <span class="dt">group =</span> ID)) <span class="op">+</span></span>
<span id="cb318-9"><a href="9.2-practical-6.html#cb318-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span></span>
<span id="cb318-10"><a href="9.2-practical-6.html#cb318-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme_classic</span>() <span class="op">+</span></span>
<span id="cb318-11"><a href="9.2-practical-6.html#cb318-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>type)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-133"></span>
<img src="BIO8940_book_files/figure-html/unnamed-chunk-133-1.svg" alt="Predicted (from m_mer) and observed value of aggression as a function of opponent size in unicorns" width="672" />
<p class="caption">
Figure 9.2: Predicted (from m_mer) and observed value of aggression as a function of opponent size in unicorns
</p>
</div>
<p>This illustrates the importance of using model predictions to see whether the model actually fits the individual-level data well or not — while the diagnostic plots looked fine, and the model captures mean plasticity, here we can see that the model really doesn’t fit the actual data very well at all.</p>
<!--The code below provides a different (and slightly more in-depth) look at this same combination of fitted slope / real data, and indicates that the fitted slopes systematically under- and over-estimate plasticity
in aggression at the individual level (figure not shown since it has 80 panels).

need to figure out the code
-->
</div>
<div id="random-regression" class="section level3 hasAnchor" number="9.2.3">
<h3><span class="header-section-number">9.2.3</span> Random regression<a href="9.2-practical-6.html#random-regression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="with-lme4" class="section level4 hasAnchor" number="9.2.3.1">
<h4><span class="header-section-number">9.2.3.1</span> with <code>lme4</code><a href="9.2-practical-6.html#with-lme4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="9.2-practical-6.html#cb319-1" aria-hidden="true"></a>rr_mer &lt;-<span class="st"> </span><span class="kw">lmer</span>(</span>
<span id="cb319-2"><a href="9.2-practical-6.html#cb319-2" aria-hidden="true"></a>  aggression <span class="op">~</span><span class="st"> </span>opp_size <span class="op">+</span><span class="st"> </span>body_size_sc <span class="op">+</span><span class="st"> </span>assay_rep_sc <span class="op">+</span><span class="st"> </span>block</span>
<span id="cb319-3"><a href="9.2-practical-6.html#cb319-3" aria-hidden="true"></a>  <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>opp_size <span class="op">|</span><span class="st"> </span>ID),</span>
<span id="cb319-4"><a href="9.2-practical-6.html#cb319-4" aria-hidden="true"></a>  <span class="dt">data =</span> unicorns</span>
<span id="cb319-5"><a href="9.2-practical-6.html#cb319-5" aria-hidden="true"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="9.2-practical-6.html#cb320-1" aria-hidden="true"></a>pred_rr_mer &lt;-<span class="st"> </span><span class="kw">augment</span>(rr_mer) <span class="op">%&gt;%</span></span>
<span id="cb320-2"><a href="9.2-practical-6.html#cb320-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(ID, block, opp_size, .fitted, aggression) <span class="op">%&gt;%</span></span>
<span id="cb320-3"><a href="9.2-practical-6.html#cb320-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(block <span class="op">==</span><span class="st"> </span><span class="fl">-0.5</span>) <span class="op">%&gt;%</span></span>
<span id="cb320-4"><a href="9.2-practical-6.html#cb320-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">gather</span>(type,aggression, <span class="st">`</span><span class="dt">.fitted</span><span class="st">`</span><span class="op">:</span>aggression)</span>
<span id="cb320-5"><a href="9.2-practical-6.html#cb320-5" aria-hidden="true"></a><span class="kw">ggplot</span>(pred_rr_mer, <span class="kw">aes</span>(<span class="dt">x =</span> opp_size, <span class="dt">y =</span> aggression, <span class="dt">group =</span> ID)) <span class="op">+</span></span>
<span id="cb320-6"><a href="9.2-practical-6.html#cb320-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span></span>
<span id="cb320-7"><a href="9.2-practical-6.html#cb320-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme_classic</span>() <span class="op">+</span></span>
<span id="cb320-8"><a href="9.2-practical-6.html#cb320-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>type)</span></code></pre></div>
<p><img src="BIO8940_book_files/figure-html/unnamed-chunk-135-1.svg" width="672" /></p>
<p>We can test the improvement of the model fit using the overloaded anova function in R to perform a likelihood ratio test (LRT):</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="9.2-practical-6.html#cb321-1" aria-hidden="true"></a><span class="kw">anova</span>(rr_mer, m_mer, <span class="dt">refit =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">npar</th>
<th align="right">AIC</th>
<th align="right">BIC</th>
<th align="right">logLik</th>
<th align="right">deviance</th>
<th align="right">Chisq</th>
<th align="right">Df</th>
<th align="right">Pr(&gt;Chisq)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">m_mer</td>
<td align="right">7</td>
<td align="right">1150.477</td>
<td align="right">1179.693</td>
<td align="right">-568.2383</td>
<td align="right">1136.477</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">rr_mer</td>
<td align="right">9</td>
<td align="right">1092.356</td>
<td align="right">1129.920</td>
<td align="right">-537.1780</td>
<td align="right">1074.356</td>
<td align="right">62.1206</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>We can see here that the LRT uses a chi-square test with 2 degrees of freedom, and indicates that the random slopes model shows a statistically significant improvement in model fit. The 2df are because there are two additional (co)variance terms estimated in the random regression model: a variance term for individual slopes, and the covariance (or correlation) between the slopes and intercepts. Let’s look at those values, and also the fixed effects parameters, via the model summary:</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="9.2-practical-6.html#cb322-1" aria-hidden="true"></a><span class="kw">summary</span>(rr_mer)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML. t-tests use Satterthwaite&#39;s method [&#39;lmerModLmerTest&#39;]
## Formula: aggression ~ opp_size + body_size_sc + assay_rep_sc + block +      (1 + opp_size | ID)
##    Data: unicorns
## 
## REML criterion at convergence: 1074.4
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -3.04932 -0.59780 -0.02002  0.59574  2.68010 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev. Corr
##  ID       (Intercept) 0.05043  0.2246       
##           opp_size    0.19167  0.4378   0.96
##  Residual             0.42816  0.6543       
## Number of obs: 480, groups:  ID, 80
## 
## Fixed effects:
##               Estimate Std. Error        df t value Pr(&gt;|t|)    
## (Intercept)    9.00181    0.03902  78.44088 230.707   &lt;2e-16 ***
## opp_size       1.05033    0.06123  79.50694  17.153   &lt;2e-16 ***
## body_size_sc   0.02725    0.03377  84.34959   0.807    0.422    
## assay_rep_sc  -0.04702    0.03945 387.69415  -1.192    0.234    
## block         -0.02169    0.05973 318.19553  -0.363    0.717    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##             (Intr) opp_sz bdy_s_ assy__
## opp_size     0.495                     
## body_siz_sc  0.000  0.000              
## assay_rp_sc  0.000 -0.064 -0.006       
## block        0.000  0.000  0.002  0.000</code></pre>
</div>
<div id="with-asreml" class="section level4 hasAnchor" number="9.2.3.2">
<h4><span class="header-section-number">9.2.3.2</span> with <code>asreml</code><a href="9.2-practical-6.html#with-asreml" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="9.2-practical-6.html#cb324-1" aria-hidden="true"></a>unicorns &lt;-<span class="st"> </span>unicorns <span class="op">%&gt;%</span></span>
<span id="cb324-2"><a href="9.2-practical-6.html#cb324-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>( <span class="dt">ID =</span> <span class="kw">as.factor</span>(ID))</span>
<span id="cb324-3"><a href="9.2-practical-6.html#cb324-3" aria-hidden="true"></a>rr_asr &lt;-<span class="st"> </span><span class="kw">asreml</span>(</span>
<span id="cb324-4"><a href="9.2-practical-6.html#cb324-4" aria-hidden="true"></a>  aggression <span class="op">~</span><span class="st"> </span>opp_size <span class="op">+</span><span class="st"> </span>body_size_sc <span class="op">+</span><span class="st"> </span>assay_rep_sc <span class="op">+</span><span class="st"> </span>block,</span>
<span id="cb324-5"><a href="9.2-practical-6.html#cb324-5" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span><span class="kw">str</span>(<span class="op">~</span><span class="st"> </span>ID <span class="op">+</span><span class="st"> </span>ID<span class="op">:</span>opp_size, <span class="op">~</span><span class="kw">us</span>(<span class="dv">2</span>)<span class="op">:</span><span class="kw">id</span>(ID)),</span>
<span id="cb324-6"><a href="9.2-practical-6.html#cb324-6" aria-hidden="true"></a>  <span class="dt">residual =</span> <span class="op">~</span><span class="st"> </span>units,</span>
<span id="cb324-7"><a href="9.2-practical-6.html#cb324-7" aria-hidden="true"></a>  <span class="dt">data =</span> unicorns,</span>
<span id="cb324-8"><a href="9.2-practical-6.html#cb324-8" aria-hidden="true"></a>  <span class="dt">maxiter =</span> <span class="dv">200</span></span>
<span id="cb324-9"><a href="9.2-practical-6.html#cb324-9" aria-hidden="true"></a>)</span></code></pre></div>
<pre><code>## Model fitted using the gamma parameterization.
## ASReml 4.1.0 Wed Jan 17 14:13:39 2024
##           LogLik        Sigma2     DF     wall    cpu
##  1      -109.426      0.463232    475 14:13:39    0.0
##  2      -105.050      0.454593    475 14:13:39    0.0
##  3      -101.814      0.443662    475 14:13:39    0.0
##  4      -100.814      0.433873    475 14:13:39    0.0
##  5      -100.683      0.428596    475 14:13:39    0.0
##  6      -100.682      0.428170    475 14:13:39    0.0</code></pre>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="9.2-practical-6.html#cb326-1" aria-hidden="true"></a><span class="kw">plot</span>(rr_asr)</span></code></pre></div>
<p><img src="BIO8940_book_files/figure-html/unnamed-chunk-140-1.svg" width="672" /></p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="9.2-practical-6.html#cb327-1" aria-hidden="true"></a><span class="kw">summary</span>(rr_asr, <span class="dt">coef =</span> <span class="ot">TRUE</span>)<span class="op">$</span>coef.fixed</span></code></pre></div>
<pre><code>##                 solution  std error     z.ratio
## block        -0.02168725 0.05973354  -0.3630665
## assay_rep_sc -0.04702032 0.03944594  -1.1920191
## body_size_sc  0.02725092 0.03377443   0.8068506
## opp_size      1.05032703 0.06123110  17.1534907
## (Intercept)   9.00181250 0.03901766 230.7112239</code></pre>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="9.2-practical-6.html#cb329-1" aria-hidden="true"></a><span class="kw">wald</span>(rr_asr, <span class="dt">ssType =</span> <span class="st">&quot;conditional&quot;</span>, <span class="dt">denDF =</span> <span class="st">&quot;numeric&quot;</span>)</span></code></pre></div>
<pre><code>## Model fitted using the gamma parameterization.
## ASReml 4.1.0 Wed Jan 17 14:13:40 2024
##           LogLik        Sigma2     DF     wall    cpu
##  1      -100.682      0.428168    475 14:13:40    0.0
##  2      -100.682      0.428168    475 14:13:40    0.0
## Calculating denominator DF</code></pre>
<pre><code>## $Wald
## [0;34m
## Wald tests for fixed effects.[0m
## [0;34mResponse: aggression[0m
## 
##              Df denDF F.inc F.con Margin      Pr
## (Intercept)   1  78.3 65490 53230        0.00000
## opp_size      1  79.5   293   294      A 0.00000
## body_size_sc  1  84.3     1     1      A 0.42202
## assay_rep_sc  1 387.6     1     1      A 0.23398
## block         1 318.1     0     0      A 0.71680
## 
## $stratumVariances
##                                 df  Variance ID+ID:opp_size!us(2)_1:1 ID+ID:opp_size!us(2)_2:1 ID+ID:opp_size!us(2)_2:2 units!R
## ID+ID:opp_size!us(2)_1:1  78.00483 0.4790737                 5.216311                -3.301137                0.5221955       1
## ID+ID:opp_size!us(2)_2:1   0.00000 0.0000000                 0.000000                 0.000000                0.0000000       1
## ID+ID:opp_size!us(2)_2:2  78.94046 1.1937287                 0.000000                 0.000000                3.9943993       1
## units!R                  318.05470 0.4281680                 0.000000                 0.000000                0.0000000       1</code></pre>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="9.2-practical-6.html#cb332-1" aria-hidden="true"></a><span class="kw">summary</span>(rr_asr)<span class="op">$</span>varcomp</span></code></pre></div>
<pre><code>##                           component  std.error   z.ratio bound %ch
## ID+ID:opp_size!us(2)_1:1 0.05042932 0.02027564  2.487187     P   0
## ID+ID:opp_size!us(2)_2:1 0.09458336 0.02400745  3.939751     P   0
## ID+ID:opp_size!us(2)_2:2 0.19165924 0.04832059  3.966409     P   0
## units!R                  0.42816954 0.03395320 12.610582     P   0</code></pre>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="9.2-practical-6.html#cb334-1" aria-hidden="true"></a>rio_asr &lt;-<span class="st"> </span><span class="kw">asreml</span>(</span>
<span id="cb334-2"><a href="9.2-practical-6.html#cb334-2" aria-hidden="true"></a>  aggression <span class="op">~</span><span class="st"> </span>opp_size <span class="op">+</span><span class="st"> </span>body_size_sc <span class="op">+</span><span class="st"> </span>assay_rep_sc <span class="op">+</span><span class="st"> </span>block,</span>
<span id="cb334-3"><a href="9.2-practical-6.html#cb334-3" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span>ID,</span>
<span id="cb334-4"><a href="9.2-practical-6.html#cb334-4" aria-hidden="true"></a>  <span class="dt">residual =</span> <span class="op">~</span>units,</span>
<span id="cb334-5"><a href="9.2-practical-6.html#cb334-5" aria-hidden="true"></a>  <span class="dt">data =</span> unicorns,</span>
<span id="cb334-6"><a href="9.2-practical-6.html#cb334-6" aria-hidden="true"></a>  <span class="dt">maxiter =</span> <span class="dv">200</span></span>
<span id="cb334-7"><a href="9.2-practical-6.html#cb334-7" aria-hidden="true"></a>)</span></code></pre></div>
<pre><code>## Model fitted using the gamma parameterization.
## ASReml 4.1.0 Wed Jan 17 14:13:40 2024
##           LogLik        Sigma2     DF     wall    cpu
##  1      -132.611      0.560353    475 14:13:40    0.0
##  2      -132.106      0.567043    475 14:13:40    0.0
##  3      -131.796      0.575157    475 14:13:40    0.0
##  4      -131.743      0.580762    475 14:13:40    0.0
##  5      -131.742      0.580480    475 14:13:40    0.0</code></pre>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="9.2-practical-6.html#cb336-1" aria-hidden="true"></a><span class="kw">pchisq</span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(rr_asr<span class="op">$</span>loglik <span class="op">-</span><span class="st"> </span>rio_asr<span class="op">$</span>loglik), <span class="dv">2</span>,</span>
<span id="cb336-2"><a href="9.2-practical-6.html#cb336-2" aria-hidden="true"></a>  <span class="dt">lower.tail =</span> <span class="ot">FALSE</span></span>
<span id="cb336-3"><a href="9.2-practical-6.html#cb336-3" aria-hidden="true"></a>)</span></code></pre></div>
<pre><code>## [1] 3.241026e-14</code></pre>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="9.2-practical-6.html#cb338-1" aria-hidden="true"></a><span class="kw">vpredict</span>(rr_asr, cor_is <span class="op">~</span><span class="st"> </span>V2 <span class="op">/</span><span class="st"> </span>(<span class="kw">sqrt</span>(V1) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(V3)))</span></code></pre></div>
<pre><code>##         Estimate        SE
## cor_is 0.9620736 0.1773965</code></pre>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="9.2-practical-6.html#cb340-1" aria-hidden="true"></a>pred_rr_asr &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">predict</span>(rr_asr,</span>
<span id="cb340-2"><a href="9.2-practical-6.html#cb340-2" aria-hidden="true"></a>  <span class="dt">classify =</span> <span class="st">&quot;opp_size:ID&quot;</span>,</span>
<span id="cb340-3"><a href="9.2-practical-6.html#cb340-3" aria-hidden="true"></a>  <span class="dt">levels =</span> <span class="kw">list</span>(</span>
<span id="cb340-4"><a href="9.2-practical-6.html#cb340-4" aria-hidden="true"></a>    <span class="st">&quot;opp_size&quot;</span> =</span>
<span id="cb340-5"><a href="9.2-practical-6.html#cb340-5" aria-hidden="true"></a><span class="st">      </span><span class="kw">c</span>(<span class="dt">opp_size =</span> <span class="dv">-1</span><span class="op">:</span><span class="dv">1</span>)</span>
<span id="cb340-6"><a href="9.2-practical-6.html#cb340-6" aria-hidden="true"></a>  )</span>
<span id="cb340-7"><a href="9.2-practical-6.html#cb340-7" aria-hidden="true"></a>)<span class="op">$</span>pvals)</span></code></pre></div>
<pre><code>## Model fitted using the gamma parameterization.
## ASReml 4.1.0 Wed Jan 17 14:13:41 2024
##           LogLik        Sigma2     DF     wall    cpu
##  1      -100.682      0.428168    475 14:13:41    0.1
##  2      -100.682      0.428168    475 14:13:41    0.0
##  3      -100.682      0.428168    475 14:13:41    0.0</code></pre>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="9.2-practical-6.html#cb342-1" aria-hidden="true"></a>p_rr &lt;-<span class="st"> </span><span class="kw">ggplot</span>(pred_rr_asr, <span class="kw">aes</span>(<span class="dt">x =</span> opp_size,</span>
<span id="cb342-2"><a href="9.2-practical-6.html#cb342-2" aria-hidden="true"></a><span class="dt">y =</span> predicted.value,</span>
<span id="cb342-3"><a href="9.2-practical-6.html#cb342-3" aria-hidden="true"></a><span class="dt">group =</span> ID)) <span class="op">+</span></span>
<span id="cb342-4"><a href="9.2-practical-6.html#cb342-4" aria-hidden="true"></a><span class="kw">geom_line</span>(<span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span></span>
<span id="cb342-5"><a href="9.2-practical-6.html#cb342-5" aria-hidden="true"></a><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb342-6"><a href="9.2-practical-6.html#cb342-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb342-7"><a href="9.2-practical-6.html#cb342-7" aria-hidden="true"></a>    <span class="dt">x =</span> <span class="st">&quot;Opponent size (SDU)&quot;</span>,</span>
<span id="cb342-8"><a href="9.2-practical-6.html#cb342-8" aria-hidden="true"></a>    <span class="dt">y =</span> <span class="st">&quot;Aggression&quot;</span></span>
<span id="cb342-9"><a href="9.2-practical-6.html#cb342-9" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb342-10"><a href="9.2-practical-6.html#cb342-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme_classic</span>()</span>
<span id="cb342-11"><a href="9.2-practical-6.html#cb342-11" aria-hidden="true"></a>p_rr</span></code></pre></div>
<p><img src="BIO8940_book_files/figure-html/unnamed-chunk-147-1.svg" width="672" /></p>
</div>
<div id="with-mcmcglmm" class="section level4 hasAnchor" number="9.2.3.3">
<h4><span class="header-section-number">9.2.3.3</span> with <code>MCMCglmm</code><a href="9.2-practical-6.html#with-mcmcglmm" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="9.2-practical-6.html#cb343-1" aria-hidden="true"></a>prior_RR &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb343-2"><a href="9.2-practical-6.html#cb343-2" aria-hidden="true"></a>  <span class="dt">R =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="dv">1</span>, <span class="dt">nu =</span> <span class="fl">0.002</span>),</span>
<span id="cb343-3"><a href="9.2-practical-6.html#cb343-3" aria-hidden="true"></a>  <span class="dt">G =</span> <span class="kw">list</span>(</span>
<span id="cb343-4"><a href="9.2-practical-6.html#cb343-4" aria-hidden="true"></a>    <span class="dt">G1 =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="kw">diag</span>(<span class="dv">2</span>)<span class="op">*</span><span class="fl">0.02</span>, <span class="dt">nu =</span> <span class="dv">3</span>,</span>
<span id="cb343-5"><a href="9.2-practical-6.html#cb343-5" aria-hidden="true"></a><span class="dt">alpha.mu =</span> <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">2</span>),</span>
<span id="cb343-6"><a href="9.2-practical-6.html#cb343-6" aria-hidden="true"></a><span class="dt">alpha.V=</span> <span class="kw">diag</span>(<span class="dv">1000</span>, <span class="dv">2</span>, <span class="dv">2</span>))))</span>
<span id="cb343-7"><a href="9.2-practical-6.html#cb343-7" aria-hidden="true"></a>rr_mcmc &lt;-<span class="st"> </span><span class="kw">MCMCglmm</span>(</span>
<span id="cb343-8"><a href="9.2-practical-6.html#cb343-8" aria-hidden="true"></a>  aggression <span class="op">~</span><span class="st"> </span>opp_size <span class="op">+</span><span class="st"> </span>assay_rep_sc <span class="op">+</span><span class="st"> </span>body_size_sc <span class="op">+</span><span class="st"> </span>block,</span>
<span id="cb343-9"><a href="9.2-practical-6.html#cb343-9" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="kw">us</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>opp_size)<span class="op">:</span>ID,</span>
<span id="cb343-10"><a href="9.2-practical-6.html#cb343-10" aria-hidden="true"></a>  <span class="dt">rcov =</span> <span class="op">~</span><span class="st"> </span>units,</span>
<span id="cb343-11"><a href="9.2-practical-6.html#cb343-11" aria-hidden="true"></a><span class="dt">family =</span> <span class="st">&quot;gaussian&quot;</span>,</span>
<span id="cb343-12"><a href="9.2-practical-6.html#cb343-12" aria-hidden="true"></a><span class="dt">prior =</span> prior_RR,</span>
<span id="cb343-13"><a href="9.2-practical-6.html#cb343-13" aria-hidden="true"></a><span class="dt">nitt=</span><span class="dv">750000</span>,</span>
<span id="cb343-14"><a href="9.2-practical-6.html#cb343-14" aria-hidden="true"></a><span class="dt">burnin=</span><span class="dv">50000</span>,</span>
<span id="cb343-15"><a href="9.2-practical-6.html#cb343-15" aria-hidden="true"></a><span class="dt">thin=</span><span class="dv">350</span>,</span>
<span id="cb343-16"><a href="9.2-practical-6.html#cb343-16" aria-hidden="true"></a><span class="dt">verbose =</span> <span class="ot">FALSE</span>,</span>
<span id="cb343-17"><a href="9.2-practical-6.html#cb343-17" aria-hidden="true"></a><span class="dt">data =</span> unicorns,</span>
<span id="cb343-18"><a href="9.2-practical-6.html#cb343-18" aria-hidden="true"></a><span class="dt">pr =</span> <span class="ot">TRUE</span>,</span>
<span id="cb343-19"><a href="9.2-practical-6.html#cb343-19" aria-hidden="true"></a><span class="dt">saveX =</span> <span class="ot">TRUE</span>, <span class="dt">saveZ =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="9.2-practical-6.html#cb344-1" aria-hidden="true"></a><span class="kw">plot</span>(rr_mcmc<span class="op">$</span>VCV)</span></code></pre></div>
<p><img src="BIO8940_book_files/figure-html/unnamed-chunk-149-1.svg" width="672" /><img src="BIO8940_book_files/figure-html/unnamed-chunk-149-2.svg" width="672" /></p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="9.2-practical-6.html#cb345-1" aria-hidden="true"></a><span class="kw">posterior.mode</span>(rr_mcmc<span class="op">$</span>VCV[, <span class="st">&quot;opp_size:opp_size.ID&quot;</span>]) <span class="co"># mean</span></span></code></pre></div>
<pre><code>##      var1 
## 0.2040523</code></pre>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="9.2-practical-6.html#cb347-1" aria-hidden="true"></a><span class="kw">HPDinterval</span>(rr_mcmc<span class="op">$</span>VCV[, <span class="st">&quot;opp_size:opp_size.ID&quot;</span>])</span></code></pre></div>
<pre><code>##          lower     upper
## var1 0.1172616 0.3094872
## attr(,&quot;Probability&quot;)
## [1] 0.95</code></pre>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="9.2-practical-6.html#cb349-1" aria-hidden="true"></a>rr_cor_mcmc &lt;-<span class="st"> </span>rr_mcmc<span class="op">$</span>VCV[, <span class="st">&quot;opp_size:(Intercept).ID&quot;</span>] <span class="op">/</span></span>
<span id="cb349-2"><a href="9.2-practical-6.html#cb349-2" aria-hidden="true"></a><span class="st">  </span>(<span class="kw">sqrt</span>(rr_mcmc<span class="op">$</span>VCV[, <span class="st">&quot;(Intercept):(Intercept).ID&quot;</span>]) <span class="op">*</span></span>
<span id="cb349-3"><a href="9.2-practical-6.html#cb349-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">sqrt</span>(rr_mcmc<span class="op">$</span>VCV[, <span class="st">&quot;opp_size:opp_size.ID&quot;</span>]))</span>
<span id="cb349-4"><a href="9.2-practical-6.html#cb349-4" aria-hidden="true"></a><span class="kw">posterior.mode</span>(rr_cor_mcmc)</span></code></pre></div>
<pre><code>##      var1 
## 0.8466038</code></pre>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="9.2-practical-6.html#cb351-1" aria-hidden="true"></a><span class="kw">HPDinterval</span>(rr_cor_mcmc)</span></code></pre></div>
<pre><code>##          lower     upper
## var1 0.5169232 0.9749839
## attr(,&quot;Probability&quot;)
## [1] 0.95</code></pre>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="9.2-practical-6.html#cb353-1" aria-hidden="true"></a>df_rand &lt;-<span class="st"> </span><span class="kw">cbind</span>(unicorns,</span>
<span id="cb353-2"><a href="9.2-practical-6.html#cb353-2" aria-hidden="true"></a>  <span class="dt">rr_fit =</span> <span class="kw">predict</span>(rr_mcmc, <span class="dt">marginal =</span> <span class="ot">NULL</span>)</span>
<span id="cb353-3"><a href="9.2-practical-6.html#cb353-3" aria-hidden="true"></a>) <span class="op">%&gt;%</span></span>
<span id="cb353-4"><a href="9.2-practical-6.html#cb353-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(ID, opp_size, rr_fit, aggression) <span class="op">%&gt;%</span></span>
<span id="cb353-5"><a href="9.2-practical-6.html#cb353-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(ID, opp_size) <span class="op">%&gt;%</span></span>
<span id="cb353-6"><a href="9.2-practical-6.html#cb353-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb353-7"><a href="9.2-practical-6.html#cb353-7" aria-hidden="true"></a>    <span class="dt">rr_fit =</span> <span class="kw">mean</span>(rr_fit),</span>
<span id="cb353-8"><a href="9.2-practical-6.html#cb353-8" aria-hidden="true"></a>    <span class="dt">aggression =</span> <span class="kw">mean</span>(aggression)</span>
<span id="cb353-9"><a href="9.2-practical-6.html#cb353-9" aria-hidden="true"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb353-10"><a href="9.2-practical-6.html#cb353-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">gather</span>(</span>
<span id="cb353-11"><a href="9.2-practical-6.html#cb353-11" aria-hidden="true"></a>    Type, Value,</span>
<span id="cb353-12"><a href="9.2-practical-6.html#cb353-12" aria-hidden="true"></a>    rr_fit<span class="op">:</span>aggression</span>
<span id="cb353-13"><a href="9.2-practical-6.html#cb353-13" aria-hidden="true"></a>  )</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;ID&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="9.2-practical-6.html#cb355-1" aria-hidden="true"></a><span class="co"># Plot separate panels for individual lines of each type</span></span>
<span id="cb355-2"><a href="9.2-practical-6.html#cb355-2" aria-hidden="true"></a><span class="kw">ggplot</span>(df_rand, <span class="kw">aes</span>(<span class="dt">x =</span> opp_size, <span class="dt">y =</span> Value, <span class="dt">group =</span> ID)) <span class="op">+</span></span>
<span id="cb355-3"><a href="9.2-practical-6.html#cb355-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span></span>
<span id="cb355-4"><a href="9.2-practical-6.html#cb355-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb355-5"><a href="9.2-practical-6.html#cb355-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme_classic</span>() <span class="op">+</span></span>
<span id="cb355-6"><a href="9.2-practical-6.html#cb355-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>Type)</span></code></pre></div>
<p><img src="BIO8940_book_files/figure-html/unnamed-chunk-152-1.svg" width="672" /></p>
<table>
<caption><span id="tab:unnamed-chunk-153">Table 9.1: </span>Variance estimated from random regression models using 3 different softwares</caption>
<thead>
<tr class="header">
<th align="left">Method</th>
<th align="right">v_int</th>
<th align="right">cov</th>
<th align="right">v_sl</th>
<th align="right">v_r</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">lmer</td>
<td align="right">0.0504347</td>
<td align="right">0.0945863</td>
<td align="right">0.1916653</td>
<td align="right">0.4281625</td>
</tr>
<tr class="even">
<td align="left">asreml</td>
<td align="right">0.0504293</td>
<td align="right">0.0945834</td>
<td align="right">0.1916592</td>
<td align="right">0.4281695</td>
</tr>
<tr class="odd">
<td align="left">MCMCglmm</td>
<td align="right">0.0446102</td>
<td align="right">0.0768445</td>
<td align="right">0.2040523</td>
<td align="right">0.4181750</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="character-state-approach" class="section level3 hasAnchor" number="9.2.4">
<h3><span class="header-section-number">9.2.4</span> Character-State approach<a href="9.2-practical-6.html#character-state-approach" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Need to pivot to a wider format</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="9.2-practical-6.html#cb356-1" aria-hidden="true"></a>unicorns_cs &lt;-<span class="st"> </span>unicorns <span class="op">%&gt;%</span></span>
<span id="cb356-2"><a href="9.2-practical-6.html#cb356-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(ID, body_size, assay_rep, block, aggression, opp_size) <span class="op">%&gt;%</span></span>
<span id="cb356-3"><a href="9.2-practical-6.html#cb356-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb356-4"><a href="9.2-practical-6.html#cb356-4" aria-hidden="true"></a>    <span class="dt">opp_size =</span> <span class="kw">recode</span>(<span class="kw">as.character</span>(opp_size), <span class="st">&quot;-1&quot;</span> =<span class="st"> &quot;s&quot;</span>, <span class="st">&quot;0&quot;</span> =<span class="st"> &quot;m&quot;</span>, <span class="st">&quot;1&quot;</span> =<span class="st"> &quot;l&quot;</span>)</span>
<span id="cb356-5"><a href="9.2-practical-6.html#cb356-5" aria-hidden="true"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb356-6"><a href="9.2-practical-6.html#cb356-6" aria-hidden="true"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="dt">agg =</span> aggression) <span class="op">%&gt;%</span></span>
<span id="cb356-7"><a href="9.2-practical-6.html#cb356-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> opp_size, <span class="dt">values_from =</span> <span class="kw">c</span>(agg, assay_rep)) <span class="op">%&gt;%</span></span>
<span id="cb356-8"><a href="9.2-practical-6.html#cb356-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb356-9"><a href="9.2-practical-6.html#cb356-9" aria-hidden="true"></a>    <span class="dt">body_size_sc =</span> <span class="kw">scale</span>(body_size),</span>
<span id="cb356-10"><a href="9.2-practical-6.html#cb356-10" aria-hidden="true"></a>    <span class="dt">opp_order =</span> <span class="kw">as.factor</span>(<span class="kw">paste</span>(assay_rep_s, assay_rep_m, assay_rep_l, <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>))</span>
<span id="cb356-11"><a href="9.2-practical-6.html#cb356-11" aria-hidden="true"></a>  )</span>
<span id="cb356-12"><a href="9.2-practical-6.html#cb356-12" aria-hidden="true"></a><span class="kw">str</span>(unicorns_cs)</span></code></pre></div>
<pre><code>## tibble [160 × 11] (S3: tbl_df/tbl/data.frame)
##  $ ID          : Factor w/ 80 levels &quot;ID_1&quot;,&quot;ID_10&quot;,..: 1 1 2 2 3 3 4 4 5 5 ...
##  $ body_size   : num [1:160] 206 207 283 288 229 ...
##  $ block       : num [1:160] -0.5 0.5 -0.5 0.5 -0.5 0.5 -0.5 0.5 -0.5 0.5 ...
##  $ agg_s       : num [1:160] 7.02 8.44 7.73 8.08 8.06 8.16 8.16 8.51 7.59 6.67 ...
##  $ agg_l       : num [1:160] 10.67 10.51 10.81 10.67 9.77 ...
##  $ agg_m       : num [1:160] 10.22 8.95 9.43 9.46 7.63 ...
##  $ assay_rep_s : int [1:160] 1 3 2 2 1 1 3 3 1 1 ...
##  $ assay_rep_l : int [1:160] 2 2 1 1 2 2 2 1 2 2 ...
##  $ assay_rep_m : int [1:160] 3 1 3 3 3 3 1 2 3 3 ...
##  $ body_size_sc: num [1:160, 1] -1.504 -1.456 0.988 1.143 -0.76 ...
##   ..- attr(*, &quot;scaled:center&quot;)= num 253
##   ..- attr(*, &quot;scaled:scale&quot;)= num 31.1
##  $ opp_order   : Factor w/ 6 levels &quot;1_2_3&quot;,&quot;1_3_2&quot;,..: 2 5 4 4 2 2 5 6 2 2 ...</code></pre>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="9.2-practical-6.html#cb358-1" aria-hidden="true"></a><span class="kw">head</span>(unicorns_cs)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 11
##   ID    body_size block agg_s agg_l agg_m assay_rep_s assay_rep_l assay_rep_m body_size_sc[,1] opp_order
##   &lt;fct&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;       &lt;int&gt;       &lt;int&gt;       &lt;int&gt;            &lt;dbl&gt; &lt;fct&gt;    
## 1 ID_1       206.  -0.5  7.02 10.7  10.2            1           2           3           -1.50  1_3_2    
## 2 ID_1       207.   0.5  8.44 10.5   8.95           3           2           1           -1.46  3_1_2    
## 3 ID_10      283.  -0.5  7.73 10.8   9.43           2           1           3            0.988 2_3_1    
## 4 ID_10      288    0.5  8.08 10.7   9.46           2           1           3            1.14  2_3_1    
## 5 ID_11      229.  -0.5  8.06  9.77  7.63           1           2           3           -0.760 1_3_2    
## 6 ID_11      236.   0.5  8.16 10.8   8.23           1           2           3           -0.525 1_3_2</code></pre>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="9.2-practical-6.html#cb360-1" aria-hidden="true"></a>cs_asr &lt;-<span class="st"> </span><span class="kw">asreml</span>(</span>
<span id="cb360-2"><a href="9.2-practical-6.html#cb360-2" aria-hidden="true"></a>  <span class="kw">cbind</span>(agg_s, agg_m, agg_l) <span class="op">~</span><span class="st"> </span>trait <span class="op">+</span><span class="st"> </span>trait<span class="op">:</span>body_size_sc <span class="op">+</span></span>
<span id="cb360-3"><a href="9.2-practical-6.html#cb360-3" aria-hidden="true"></a><span class="st">    </span>trait<span class="op">:</span>block <span class="op">+</span></span>
<span id="cb360-4"><a href="9.2-practical-6.html#cb360-4" aria-hidden="true"></a><span class="st">    </span>trait<span class="op">:</span>opp_order,</span>
<span id="cb360-5"><a href="9.2-practical-6.html#cb360-5" aria-hidden="true"></a>  <span class="dt">random =</span><span class="op">~</span><span class="st"> </span>ID<span class="op">:</span><span class="kw">us</span>(trait),</span>
<span id="cb360-6"><a href="9.2-practical-6.html#cb360-6" aria-hidden="true"></a>  <span class="dt">residual =</span><span class="op">~</span><span class="st"> </span>units<span class="op">:</span><span class="kw">us</span>(trait),</span>
<span id="cb360-7"><a href="9.2-practical-6.html#cb360-7" aria-hidden="true"></a>  <span class="dt">data =</span> unicorns_cs,</span>
<span id="cb360-8"><a href="9.2-practical-6.html#cb360-8" aria-hidden="true"></a>  <span class="dt">maxiter =</span> <span class="dv">200</span></span>
<span id="cb360-9"><a href="9.2-practical-6.html#cb360-9" aria-hidden="true"></a>)</span></code></pre></div>
<pre><code>## Model fitted using the sigma parameterization.
## ASReml 4.1.0 Wed Jan 17 14:17:13 2024
##           LogLik        Sigma2     DF     wall    cpu
##  1      -150.172           1.0    456 14:17:13    0.0
##  2      -129.658           1.0    456 14:17:13    0.0
##  3      -110.454           1.0    456 14:17:13    0.0
##  4      -101.879           1.0    456 14:17:13    0.0
##  5      -100.092           1.0    456 14:17:13    0.0
##  6      -100.054           1.0    456 14:17:13    0.0
##  7      -100.054           1.0    456 14:17:13    0.0</code></pre>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="9.2-practical-6.html#cb362-1" aria-hidden="true"></a><span class="kw">plot</span>(<span class="kw">residuals</span>(cs_asr) <span class="op">~</span><span class="st"> </span><span class="kw">fitted</span>(cs_asr))</span></code></pre></div>
<p><img src="BIO8940_book_files/figure-html/unnamed-chunk-155-1.svg" width="672" /></p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="9.2-practical-6.html#cb363-1" aria-hidden="true"></a><span class="kw">qqnorm</span>(<span class="kw">residuals</span>(cs_asr))</span>
<span id="cb363-2"><a href="9.2-practical-6.html#cb363-2" aria-hidden="true"></a><span class="kw">qqline</span>(<span class="kw">residuals</span>(cs_asr))</span></code></pre></div>
<p><img src="BIO8940_book_files/figure-html/unnamed-chunk-155-2.svg" width="672" /></p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="9.2-practical-6.html#cb364-1" aria-hidden="true"></a><span class="kw">hist</span>(<span class="kw">residuals</span>(cs_asr))</span></code></pre></div>
<p><img src="BIO8940_book_files/figure-html/unnamed-chunk-155-3.svg" width="672" /></p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="9.2-practical-6.html#cb365-1" aria-hidden="true"></a><span class="kw">summary</span>(cs_asr, <span class="dt">all =</span> T)<span class="op">$</span>coef.fixed</span></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="9.2-practical-6.html#cb367-1" aria-hidden="true"></a><span class="kw">wald</span>(cs_asr, <span class="dt">ssType =</span> <span class="st">&quot;conditional&quot;</span>, <span class="dt">denDF =</span> <span class="st">&quot;numeric&quot;</span>)</span></code></pre></div>
<pre><code>## Model fitted using the sigma parameterization.
## ASReml 4.1.0 Wed Jan 17 14:17:13 2024
##           LogLik        Sigma2     DF     wall    cpu
##  1      -100.054           1.0    456 14:17:13    0.0
##  2      -100.054           1.0    456 14:17:13    0.0
## Calculating denominator DF</code></pre>
<pre><code>## $Wald
## [0;34m
## Wald tests for fixed effects.[0m
## [0;34mResponse: cbind(agg_s, agg_m, agg_l)[0m
## 
##                    Df denDF   F.inc   F.con Margin      Pr
## trait               3  73.2 21080.0 21080.0        0.00000
## trait:body_size_sc  3  86.6     0.4     0.5      B 0.68324
## trait:block         3  75.2     0.6     0.3      B 0.82418
## trait:opp_order    15 240.5     1.3     1.3      B 0.23282
## 
## $stratumVariances
## NULL</code></pre>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="9.2-practical-6.html#cb370-1" aria-hidden="true"></a><span class="kw">summary</span>(cs_asr)<span class="op">$</span>varcomp[, <span class="kw">c</span>(<span class="st">&quot;component&quot;</span>, <span class="st">&quot;std.error&quot;</span>)]</span></code></pre></div>
<pre><code>##                                  component  std.error
## ID:trait!trait_agg_s:agg_s     0.192959991 0.06321872
## ID:trait!trait_agg_m:agg_s    -0.168519644 0.05085583
## ID:trait!trait_agg_m:agg_m     0.245594370 0.07096325
## ID:trait!trait_agg_l:agg_s    -0.151990204 0.05660748
## ID:trait!trait_agg_l:agg_m     0.158418588 0.06374995
## ID:trait!trait_agg_l:agg_l     0.312548090 0.09125168
## units:trait!R                  1.000000000         NA
## units:trait!trait_agg_s:agg_s  0.318089965 0.05198135
## units:trait!trait_agg_m:agg_s  0.010362390 0.03695483
## units:trait!trait_agg_m:agg_m  0.322379911 0.05248291
## units:trait!trait_agg_l:agg_s -0.009311656 0.04168455
## units:trait!trait_agg_l:agg_m  0.159240476 0.04569305
## units:trait!trait_agg_l:agg_l  0.405942147 0.06679700</code></pre>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="9.2-practical-6.html#cb372-1" aria-hidden="true"></a>cs_idh_asr &lt;-<span class="st"> </span><span class="kw">asreml</span>(</span>
<span id="cb372-2"><a href="9.2-practical-6.html#cb372-2" aria-hidden="true"></a>  <span class="kw">cbind</span>(agg_s, agg_m, agg_l) <span class="op">~</span><span class="st"> </span>trait <span class="op">+</span><span class="st"> </span>trait<span class="op">:</span>body_size_sc <span class="op">+</span></span>
<span id="cb372-3"><a href="9.2-practical-6.html#cb372-3" aria-hidden="true"></a><span class="st">    </span>trait<span class="op">:</span>block <span class="op">+</span></span>
<span id="cb372-4"><a href="9.2-practical-6.html#cb372-4" aria-hidden="true"></a><span class="st">    </span>trait<span class="op">:</span>opp_order,</span>
<span id="cb372-5"><a href="9.2-practical-6.html#cb372-5" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span>ID<span class="op">:</span><span class="kw">idh</span>(trait),</span>
<span id="cb372-6"><a href="9.2-practical-6.html#cb372-6" aria-hidden="true"></a>  <span class="dt">residual =</span> <span class="op">~</span><span class="st"> </span>units<span class="op">:</span><span class="kw">us</span>(trait),</span>
<span id="cb372-7"><a href="9.2-practical-6.html#cb372-7" aria-hidden="true"></a>  <span class="dt">data =</span> unicorns_cs,</span>
<span id="cb372-8"><a href="9.2-practical-6.html#cb372-8" aria-hidden="true"></a>  <span class="dt">maxiter =</span> <span class="dv">200</span></span>
<span id="cb372-9"><a href="9.2-practical-6.html#cb372-9" aria-hidden="true"></a>)</span></code></pre></div>
<pre><code>## Model fitted using the sigma parameterization.
## ASReml 4.1.0 Wed Jan 17 14:17:14 2024
##           LogLik        Sigma2     DF     wall    cpu
##  1      -147.068           1.0    456 14:17:14    0.0
##  2      -131.268           1.0    456 14:17:14    0.0
##  3      -116.908           1.0    456 14:17:14    0.0
##  4      -110.996           1.0    456 14:17:14    0.0
##  5      -109.905           1.0    456 14:17:14    0.0
##  6      -109.866           1.0    456 14:17:14    0.0
##  7      -109.863           1.0    456 14:17:14    0.0</code></pre>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="9.2-practical-6.html#cb374-1" aria-hidden="true"></a><span class="kw">pchisq</span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(cs_asr<span class="op">$</span>loglik <span class="op">-</span><span class="st"> </span>cs_idh_asr<span class="op">$</span>loglik), <span class="dv">3</span>,</span>
<span id="cb374-2"><a href="9.2-practical-6.html#cb374-2" aria-hidden="true"></a>  <span class="dt">lower.tail =</span> <span class="ot">FALSE</span></span>
<span id="cb374-3"><a href="9.2-practical-6.html#cb374-3" aria-hidden="true"></a>)</span></code></pre></div>
<pre><code>## [1] 0.0002038324</code></pre>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="9.2-practical-6.html#cb376-1" aria-hidden="true"></a><span class="kw">vpredict</span>(cs_asr, cor_S_M <span class="op">~</span><span class="st"> </span>V2 <span class="op">/</span><span class="st"> </span>(<span class="kw">sqrt</span>(V1) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(V3)))</span></code></pre></div>
<pre><code>##           Estimate        SE
## cor_S_M -0.7741189 0.1869789</code></pre>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="9.2-practical-6.html#cb378-1" aria-hidden="true"></a><span class="kw">vpredict</span>(cs_asr, cor_M_L <span class="op">~</span><span class="st"> </span>V5 <span class="op">/</span><span class="st"> </span>(<span class="kw">sqrt</span>(V3) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(V6)))</span></code></pre></div>
<pre><code>##          Estimate        SE
## cor_M_L 0.5717926 0.1469504</code></pre>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="9.2-practical-6.html#cb380-1" aria-hidden="true"></a><span class="kw">vpredict</span>(cs_asr, cor_S_L <span class="op">~</span><span class="st"> </span>V4 <span class="op">/</span><span class="st"> </span>(<span class="kw">sqrt</span>(V1) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(V6)))</span></code></pre></div>
<pre><code>##           Estimate        SE
## cor_S_L -0.6189044 0.1912133</code></pre>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="9.2-practical-6.html#cb382-1" aria-hidden="true"></a><span class="kw">vpredict</span>(cs_asr, prop_S <span class="op">~</span><span class="st"> </span>V1 <span class="op">/</span><span class="st"> </span>(V1 <span class="op">+</span><span class="st"> </span>V8))</span></code></pre></div>
<pre><code>##         Estimate         SE
## prop_S 0.3775756 0.09950306</code></pre>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="9.2-practical-6.html#cb384-1" aria-hidden="true"></a><span class="kw">vpredict</span>(cs_asr, prop_M <span class="op">~</span><span class="st"> </span>V3 <span class="op">/</span><span class="st"> </span>(V3 <span class="op">+</span><span class="st"> </span>V10))</span></code></pre></div>
<pre><code>##        Estimate        SE
## prop_M 0.432404 0.0934477</code></pre>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="9.2-practical-6.html#cb386-1" aria-hidden="true"></a><span class="kw">vpredict</span>(cs_asr, prop_L <span class="op">~</span><span class="st"> </span>V6 <span class="op">/</span><span class="st"> </span>(V6 <span class="op">+</span><span class="st"> </span>V13))</span></code></pre></div>
<pre><code>##         Estimate         SE
## prop_L 0.4350067 0.09498512</code></pre>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="9.2-practical-6.html#cb388-1" aria-hidden="true"></a>init_CS_cor1_tri &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb388-2"><a href="9.2-practical-6.html#cb388-2" aria-hidden="true"></a>  <span class="fl">0.999</span>,</span>
<span id="cb388-3"><a href="9.2-practical-6.html#cb388-3" aria-hidden="true"></a>  <span class="fl">0.999</span>, <span class="fl">0.999</span>,</span>
<span id="cb388-4"><a href="9.2-practical-6.html#cb388-4" aria-hidden="true"></a>  <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span></span>
<span id="cb388-5"><a href="9.2-practical-6.html#cb388-5" aria-hidden="true"></a>)</span>
<span id="cb388-6"><a href="9.2-practical-6.html#cb388-6" aria-hidden="true"></a><span class="kw">names</span>(init_CS_cor1_tri) &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb388-7"><a href="9.2-practical-6.html#cb388-7" aria-hidden="true"></a>  <span class="st">&quot;F&quot;</span>,</span>
<span id="cb388-8"><a href="9.2-practical-6.html#cb388-8" aria-hidden="true"></a>  <span class="st">&quot;F&quot;</span>, <span class="st">&quot;F&quot;</span>,</span>
<span id="cb388-9"><a href="9.2-practical-6.html#cb388-9" aria-hidden="true"></a>  <span class="st">&quot;U&quot;</span>, <span class="st">&quot;U&quot;</span>, <span class="st">&quot;U&quot;</span></span>
<span id="cb388-10"><a href="9.2-practical-6.html#cb388-10" aria-hidden="true"></a>)</span>
<span id="cb388-11"><a href="9.2-practical-6.html#cb388-11" aria-hidden="true"></a>cs_asr_cor1_tri &lt;-<span class="st"> </span><span class="kw">asreml</span>(</span>
<span id="cb388-12"><a href="9.2-practical-6.html#cb388-12" aria-hidden="true"></a>  <span class="kw">cbind</span>(agg_s, agg_m, agg_l) <span class="op">~</span><span class="st"> </span>trait <span class="op">+</span><span class="st"> </span>trait<span class="op">:</span>body_size_sc <span class="op">+</span></span>
<span id="cb388-13"><a href="9.2-practical-6.html#cb388-13" aria-hidden="true"></a><span class="st">    </span>trait<span class="op">:</span>block <span class="op">+</span></span>
<span id="cb388-14"><a href="9.2-practical-6.html#cb388-14" aria-hidden="true"></a><span class="st">    </span>trait<span class="op">:</span>opp_order,</span>
<span id="cb388-15"><a href="9.2-practical-6.html#cb388-15" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span>ID<span class="op">:</span><span class="kw">corgh</span>(trait, <span class="dt">init =</span> init_CS_cor1_tri),</span>
<span id="cb388-16"><a href="9.2-practical-6.html#cb388-16" aria-hidden="true"></a><span class="dt">residual =</span> <span class="op">~</span><span class="st"> </span>units<span class="op">:</span><span class="kw">us</span>(trait),</span>
<span id="cb388-17"><a href="9.2-practical-6.html#cb388-17" aria-hidden="true"></a><span class="dt">data =</span> unicorns_cs,</span>
<span id="cb388-18"><a href="9.2-practical-6.html#cb388-18" aria-hidden="true"></a><span class="dt">maxiter =</span> <span class="dv">500</span></span>
<span id="cb388-19"><a href="9.2-practical-6.html#cb388-19" aria-hidden="true"></a>)</span></code></pre></div>
<pre><code>## Model fitted using the sigma parameterization.
## ASReml 4.1.0 Wed Jan 17 14:17:14 2024
##           LogLik        Sigma2     DF     wall    cpu
##  1      -228.016           1.0    456 14:17:14    0.0 (3 restrained)
##  2      -150.014           1.0    456 14:17:14    0.0
##  3      -129.580           1.0    456 14:17:14    0.0
##  4      -119.992           1.0    456 14:17:14    0.0 (1 restrained)
##  5      -116.907           1.0    456 14:17:14    0.0 (1 restrained)
##  6      -115.772           1.0    456 14:17:14    0.0
##  7      -115.647           1.0    456 14:17:14    0.0
##  8      -115.588           1.0    456 14:17:14    0.0
##  9      -115.533           1.0    456 14:17:14    0.0
## 10      -115.479           1.0    456 14:17:14    0.0
## 11      -115.427           1.0    456 14:17:14    0.0
## 12      -115.378           1.0    456 14:17:14    0.0
## 13      -115.331           1.0    456 14:17:14    0.0
## 14      -115.289           1.0    456 14:17:14    0.0
## 15      -115.251           1.0    456 14:17:14    0.0
## 16      -115.217           1.0    456 14:17:14    0.0
## 17      -115.188           1.0    456 14:17:14    0.0
## 18      -115.162           1.0    456 14:17:14    0.0
## 19      -115.141           1.0    456 14:17:14    0.0
## 20      -115.122           1.0    456 14:17:14    0.0
## 21      -115.107           1.0    456 14:17:14    0.0
## 22      -115.093           1.0    456 14:17:14    0.0
## 23      -115.082           1.0    456 14:17:14    0.0
## 24      -115.073           1.0    456 14:17:14    0.0 (1 restrained)
## 25      -115.064           1.0    456 14:17:14    0.0
## 26      -115.064           1.0    456 14:17:14    0.0</code></pre>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="9.2-practical-6.html#cb390-1" aria-hidden="true"></a><span class="kw">pchisq</span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(cs_asr<span class="op">$</span>loglik <span class="op">-</span><span class="st"> </span>cs_asr_cor1_tri<span class="op">$</span>loglik),</span>
<span id="cb390-2"><a href="9.2-practical-6.html#cb390-2" aria-hidden="true"></a>  <span class="dv">3</span>,</span>
<span id="cb390-3"><a href="9.2-practical-6.html#cb390-3" aria-hidden="true"></a>  <span class="dt">lower.tail =</span> <span class="ot">FALSE</span></span>
<span id="cb390-4"><a href="9.2-practical-6.html#cb390-4" aria-hidden="true"></a>)</span></code></pre></div>
<pre><code>## [1] 1.367792e-06</code></pre>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="9.2-practical-6.html#cb392-1" aria-hidden="true"></a>df_CS_pred &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">predict</span>(cs_asr,</span>
<span id="cb392-2"><a href="9.2-practical-6.html#cb392-2" aria-hidden="true"></a>  <span class="dt">classify =</span> <span class="st">&quot;trait:ID&quot;</span></span>
<span id="cb392-3"><a href="9.2-practical-6.html#cb392-3" aria-hidden="true"></a>)<span class="op">$</span>pvals)</span></code></pre></div>
<pre><code>## Model fitted using the sigma parameterization.
## ASReml 4.1.0 Wed Jan 17 14:17:15 2024
##           LogLik        Sigma2     DF     wall    cpu
##  1      -100.054           1.0    456 14:17:15    0.1
##  2      -100.054           1.0    456 14:17:15    0.0
##  3      -100.054           1.0    456 14:17:15    0.0</code></pre>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="9.2-practical-6.html#cb394-1" aria-hidden="true"></a><span class="co"># Add numeric variable for easier plotting</span></span>
<span id="cb394-2"><a href="9.2-practical-6.html#cb394-2" aria-hidden="true"></a><span class="co"># of opponent size</span></span>
<span id="cb394-3"><a href="9.2-practical-6.html#cb394-3" aria-hidden="true"></a>df_CS_pred &lt;-<span class="st"> </span>df_CS_pred <span class="op">%&gt;%</span></span>
<span id="cb394-4"><a href="9.2-practical-6.html#cb394-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sizeNum =</span> <span class="kw">ifelse</span>(trait <span class="op">==</span><span class="st"> &quot;agg_s&quot;</span>, <span class="dv">-1</span>,</span>
<span id="cb394-5"><a href="9.2-practical-6.html#cb394-5" aria-hidden="true"></a>    <span class="kw">ifelse</span>(trait <span class="op">==</span><span class="st"> &quot;agg_m&quot;</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb394-6"><a href="9.2-practical-6.html#cb394-6" aria-hidden="true"></a>  ))</span>
<span id="cb394-7"><a href="9.2-practical-6.html#cb394-7" aria-hidden="true"></a>p_cs &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df_CS_pred, <span class="kw">aes</span>(</span>
<span id="cb394-8"><a href="9.2-practical-6.html#cb394-8" aria-hidden="true"></a>  <span class="dt">x =</span> sizeNum,</span>
<span id="cb394-9"><a href="9.2-practical-6.html#cb394-9" aria-hidden="true"></a>  <span class="dt">y =</span> predicted.value,</span>
<span id="cb394-10"><a href="9.2-practical-6.html#cb394-10" aria-hidden="true"></a>  <span class="dt">group =</span> ID</span>
<span id="cb394-11"><a href="9.2-practical-6.html#cb394-11" aria-hidden="true"></a>)) <span class="op">+</span></span>
<span id="cb394-12"><a href="9.2-practical-6.html#cb394-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span></span>
<span id="cb394-13"><a href="9.2-practical-6.html#cb394-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb394-14"><a href="9.2-practical-6.html#cb394-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb394-15"><a href="9.2-practical-6.html#cb394-15" aria-hidden="true"></a>    <span class="dt">x =</span> <span class="st">&quot;Opponent size (SDU)&quot;</span>,</span>
<span id="cb394-16"><a href="9.2-practical-6.html#cb394-16" aria-hidden="true"></a>    <span class="dt">y =</span> <span class="st">&quot;Aggression&quot;</span></span>
<span id="cb394-17"><a href="9.2-practical-6.html#cb394-17" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb394-18"><a href="9.2-practical-6.html#cb394-18" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme_classic</span>()</span>
<span id="cb394-19"><a href="9.2-practical-6.html#cb394-19" aria-hidden="true"></a>p_cs</span></code></pre></div>
<p><img src="BIO8940_book_files/figure-html/unnamed-chunk-164-1.svg" width="672" /></p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="9.2-practical-6.html#cb395-1" aria-hidden="true"></a>unicorns &lt;-<span class="st"> </span><span class="kw">arrange</span>(unicorns, opp_size, <span class="dt">by_group =</span> ID)</span>
<span id="cb395-2"><a href="9.2-practical-6.html#cb395-2" aria-hidden="true"></a>p_obs &lt;-<span class="st"> </span><span class="kw">ggplot</span>(unicorns[unicorns<span class="op">$</span>block<span class="op">==-</span><span class="fl">0.5</span>,], <span class="kw">aes</span>(<span class="dt">x =</span> opp_size, <span class="dt">y =</span> aggression, <span class="dt">group =</span> ID)) <span class="op">+</span></span>
<span id="cb395-3"><a href="9.2-practical-6.html#cb395-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span></span>
<span id="cb395-4"><a href="9.2-practical-6.html#cb395-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb395-5"><a href="9.2-practical-6.html#cb395-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb395-6"><a href="9.2-practical-6.html#cb395-6" aria-hidden="true"></a>    <span class="dt">x =</span> <span class="st">&quot;Opponent size (SDU)&quot;</span>,</span>
<span id="cb395-7"><a href="9.2-practical-6.html#cb395-7" aria-hidden="true"></a>    <span class="dt">y =</span> <span class="st">&quot;Aggression&quot;</span></span>
<span id="cb395-8"><a href="9.2-practical-6.html#cb395-8" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb395-9"><a href="9.2-practical-6.html#cb395-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Observed&quot;</span>) <span class="op">+</span></span>
<span id="cb395-10"><a href="9.2-practical-6.html#cb395-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">ylim</span>(<span class="fl">5.9</span>, <span class="dv">12</span>) <span class="op">+</span></span>
<span id="cb395-11"><a href="9.2-practical-6.html#cb395-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme_classic</span>()</span>
<span id="cb395-12"><a href="9.2-practical-6.html#cb395-12" aria-hidden="true"></a></span>
<span id="cb395-13"><a href="9.2-practical-6.html#cb395-13" aria-hidden="true"></a>p_rr &lt;-<span class="st"> </span>p_rr <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Random regression&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="fl">5.9</span>, <span class="dv">12</span>)</span>
<span id="cb395-14"><a href="9.2-practical-6.html#cb395-14" aria-hidden="true"></a>p_cs &lt;-<span class="st"> </span>p_cs <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Character-State&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="fl">5.9</span>, <span class="dv">12</span>)</span>
<span id="cb395-15"><a href="9.2-practical-6.html#cb395-15" aria-hidden="true"></a>p_obs <span class="op">+</span><span class="st"> </span>p_rr <span class="op">+</span><span class="st"> </span>p_cs</span></code></pre></div>
<pre><code>## Warning: Removed 2 rows containing missing
## values (`geom_line()`).</code></pre>
<p><img src="BIO8940_book_files/figure-html/unnamed-chunk-165-1.svg" width="672" /></p>
</div>
<div id="from-random-regression-to-character-state" class="section level3 hasAnchor" number="9.2.5">
<h3><span class="header-section-number">9.2.5</span> From random regression to character-state<a href="9.2-practical-6.html#from-random-regression-to-character-state" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="9.2-practical-6.html#cb397-1" aria-hidden="true"></a>var_mat_asr &lt;-<span class="st"> </span><span class="cf">function</span>(model, var_names, pos){</span>
<span id="cb397-2"><a href="9.2-practical-6.html#cb397-2" aria-hidden="true"></a>  size &lt;-<span class="st"> </span><span class="kw">length</span>(var_names)</span>
<span id="cb397-3"><a href="9.2-practical-6.html#cb397-3" aria-hidden="true"></a>  v_out &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">ncol =</span> size, <span class="dt">nrow =</span> size)</span>
<span id="cb397-4"><a href="9.2-practical-6.html#cb397-4" aria-hidden="true"></a>  <span class="kw">rownames</span>(v_out) &lt;-<span class="st"> </span>var_names</span>
<span id="cb397-5"><a href="9.2-practical-6.html#cb397-5" aria-hidden="true"></a>  <span class="kw">colnames</span>(v_out) &lt;-<span class="st"> </span>var_names</span>
<span id="cb397-6"><a href="9.2-practical-6.html#cb397-6" aria-hidden="true"></a>  v_out[<span class="kw">upper.tri</span>(v_out, <span class="dt">diag =</span> <span class="ot">TRUE</span>)] &lt;-<span class="st"> </span><span class="kw">summary</span>(model)<span class="op">$</span>varcomp[pos, <span class="dv">1</span>]</span>
<span id="cb397-7"><a href="9.2-practical-6.html#cb397-7" aria-hidden="true"></a>  v_out &lt;-<span class="st"> </span><span class="kw">forceSymmetric</span>(v_out, <span class="dt">uplo =</span> <span class="st">&quot;U&quot;</span>)</span>
<span id="cb397-8"><a href="9.2-practical-6.html#cb397-8" aria-hidden="true"></a>  <span class="kw">as.matrix</span>(v_out)</span>
<span id="cb397-9"><a href="9.2-practical-6.html#cb397-9" aria-hidden="true"></a>}</span>
<span id="cb397-10"><a href="9.2-practical-6.html#cb397-10" aria-hidden="true"></a>v_id_rr &lt;-<span class="st"> </span><span class="kw">var_mat_asr</span>(rr_asr, <span class="kw">c</span>(<span class="st">&quot;v_int&quot;</span>, <span class="st">&quot;v_sl&quot;</span>), <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</span>
<span id="cb397-11"><a href="9.2-practical-6.html#cb397-11" aria-hidden="true"></a>knitr<span class="op">::</span><span class="kw">kable</span>(v_id_rr, <span class="dt">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">v_int</th>
<th align="right">v_sl</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">v_int</td>
<td align="right">0.050</td>
<td align="right">0.095</td>
</tr>
<tr class="even">
<td align="left">v_sl</td>
<td align="right">0.095</td>
<td align="right">0.192</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="9.2-practical-6.html#cb398-1" aria-hidden="true"></a>v_id_cs &lt;-<span class="st"> </span><span class="kw">var_mat_asr</span>(cs_asr, <span class="kw">c</span>(<span class="st">&quot;v_s&quot;</span>, <span class="st">&quot;v_m&quot;</span>, <span class="st">&quot;v_l&quot;</span>), <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>)</span>
<span id="cb398-2"><a href="9.2-practical-6.html#cb398-2" aria-hidden="true"></a>knitr<span class="op">::</span><span class="kw">kable</span>(v_id_cs, <span class="dt">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">v_s</th>
<th align="right">v_m</th>
<th align="right">v_l</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">v_s</td>
<td align="right">0.193</td>
<td align="right">-0.169</td>
<td align="right">-0.152</td>
</tr>
<tr class="even">
<td align="left">v_m</td>
<td align="right">-0.169</td>
<td align="right">0.246</td>
<td align="right">0.158</td>
</tr>
<tr class="odd">
<td align="left">v_l</td>
<td align="right">-0.152</td>
<td align="right">0.158</td>
<td align="right">0.313</td>
</tr>
</tbody>
</table>
<p>We also need to make a second matrix, let’s call it <strong>Q</strong> (no particular reason, pick something else if you want). This is going to contain the values needed to turn an individual’s intercept (mean) and slope (plasticity) deviations into estimates of environment-specific individual merit in a character state model.</p>
<p>What do we mean by this? Well if an individual i has an intercept deviation of ID<sub>int(i)</sub> and a slope deviation of ID<sub>slp(i)</sub> for a given value of the environment <code>opp_size</code> we might be interested in:</p>
<p>ID<sub>i</sub> = (1 x ID<sub>int(i)</sub>) + (<code>opp_size</code> x ID<sub>slp(i)</sub>)</p>
<p>We want to look at character states representing the three observed values of <code>opp_size</code> here so</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="9.2-practical-6.html#cb399-1" aria-hidden="true"></a>Q &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">cbind</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb399-2"><a href="9.2-practical-6.html#cb399-2" aria-hidden="true"></a>                    <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)))</span></code></pre></div>
<p>Then we can generate our among-individual covariance matrix environment specific aggresiveness, which we can call <strong>ID_cs_rr</strong> by matrix multiplication:</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="9.2-practical-6.html#cb400-1" aria-hidden="true"></a>ID_cs_rr&lt;-<span class="st"> </span>Q <span class="op">%*%</span><span class="st"> </span>v_id_rr <span class="op">%*%</span><span class="kw">t</span>(Q)    <span class="co">#where t(Q) is the transpose of Q</span></span>
<span id="cb400-2"><a href="9.2-practical-6.html#cb400-2" aria-hidden="true"></a>                               <span class="co">#and %*% is matrix multiplication</span></span>
<span id="cb400-3"><a href="9.2-practical-6.html#cb400-3" aria-hidden="true"></a></span>
<span id="cb400-4"><a href="9.2-practical-6.html#cb400-4" aria-hidden="true"></a>ID_cs_rr  <span class="co">#rows and columns correspond to aggressiveness at opp_size=-1,0,1 in that order</span></span></code></pre></div>
<pre><code>##             [,1]        [,2]       [,3]
## [1,]  0.05292184 -0.04415404 -0.1412299
## [2,] -0.04415404  0.05042932  0.1450127
## [3,] -0.14122993  0.14501267  0.4312553</code></pre>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="9.2-practical-6.html#cb402-1" aria-hidden="true"></a><span class="kw">cov2cor</span>(ID_cs_rr)   <span class="co">#Converting to a correlation scale</span></span></code></pre></div>
<pre><code>##            [,1]       [,2]       [,3]
## [1,]  1.0000000 -0.8546956 -0.9348503
## [2,] -0.8546956  1.0000000  0.9833253
## [3,] -0.9348503  0.9833253  1.0000000</code></pre>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="9.2-practical-6.html#cb404-1" aria-hidden="true"></a><span class="kw">cov2cor</span>(v_id_cs)</span></code></pre></div>
<pre><code>##            v_s        v_m        v_l
## v_s  1.0000000 -0.7741189 -0.6189044
## v_m -0.7741189  1.0000000  0.5717926
## v_l -0.6189044  0.5717926  1.0000000</code></pre>
</div>
<div id="conclusions-2" class="section level3 hasAnchor" number="9.2.6">
<h3><span class="header-section-number">9.2.6</span> Conclusions<a href="9.2-practical-6.html#conclusions-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="happy-multivariate-models-1" class="section level3 hasAnchor" number="9.2.7">
<h3><span class="header-section-number">9.2.7</span> Happy multivariate models<a href="9.2-practical-6.html#happy-multivariate-models-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-170"></span>
<img src="images/blue_dragon.jpg" alt="A female blue dragon of the West" width="50%" />
<p class="caption">
Figure 9.3: A female blue dragon of the West
</p>
</div>

</div>
</div>
<!-- </div> -->
<script src="js/solution.js"></script>
            </section>

          </div>
        </div>
      </div>
<a href="9.1-lecture-8.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="10-beyond-p-0.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/BIO8940-uOttawa/class_book/02_06-randreg.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["BIO8940_book.pdf", "BIO8940_book.epub", "BIO8940_book.mobi"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
