<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5.2 Practical | BIO8940 Advanced stats and Open Science</title>
  <meta name="description" content="Theory and practicals for BIO8940 course at the University of Ottawa" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="5.2 Practical | BIO8940 Advanced stats and Open Science" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="/images/missing.png" />
  <meta property="og:description" content="Theory and practicals for BIO8940 course at the University of Ottawa" />
  <meta name="github-repo" content="BIO8940-uOttawa/class_book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5.2 Practical | BIO8940 Advanced stats and Open Science" />
  
  <meta name="twitter:description" content="Theory and practicals for BIO8940 course at the University of Ottawa" />
  <meta name="twitter:image" content="/images/missing.png" />

<meta name="author" content="Julien Martin" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="5.1-lecture-4.html"/>
<link rel="next" href="6-introduction-to-glmm.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced stats and open science</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Note</a></li>
<li class="chapter" data-level="" data-path="préface.html"><a href="préface.html"><i class="fa fa-check"></i>Préface</a>
<ul>
<li class="chapter" data-level="" data-path="quelques-points-importants-à-retenir.html"><a href="quelques-points-importants-à-retenir.html"><i class="fa fa-check"></i>Quelques points importants à retenir</a></li>
<li class="chapter" data-level="" data-path="quest-ce-que-r-et-pourquoi-lutiliser-dans-ce-cours.html"><a href="quest-ce-que-r-et-pourquoi-lutiliser-dans-ce-cours.html"><i class="fa fa-check"></i>Qu’est-ce que R et pourquoi l’utiliser dans ce cours?</a></li>
<li class="chapter" data-level="" data-path="installation-des-logiciels-nécessaires.html"><a href="installation-des-logiciels-nécessaires.html"><i class="fa fa-check"></i>Installation des logiciels nécessaires</a>
<ul>
<li class="chapter" data-level="" data-path="installation-des-logiciels-nécessaires.html"><a href="installation-des-logiciels-nécessaires.html#r"><i class="fa fa-check"></i>R</a></li>
<li class="chapter" data-level="0.0.1" data-path="installation-des-logiciels-nécessaires.html"><a href="installation-des-logiciels-nécessaires.html#text-editor-or-ide"><i class="fa fa-check"></i><b>0.0.1</b> Text editor or IDE</a></li>
<li class="chapter" data-level="" data-path="installation-des-logiciels-nécessaires.html"><a href="installation-des-logiciels-nécessaires.html#paquets-pour-r"><i class="fa fa-check"></i>Paquets pour R</a></li>
<li class="chapter" data-level="" data-path="installation-des-logiciels-nécessaires.html"><a href="installation-des-logiciels-nécessaires.html#pandoc"><i class="fa fa-check"></i>pandoc</a></li>
<li class="chapter" data-level="" data-path="installation-des-logiciels-nécessaires.html"><a href="installation-des-logiciels-nécessaires.html#latex"><i class="fa fa-check"></i>laTex</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="instructions-générales-pour-les-laboratoires.html"><a href="instructions-générales-pour-les-laboratoires.html"><i class="fa fa-check"></i>Instructions générales pour les laboratoires</a></li>
<li class="chapter" data-level="" data-path="notes-sur-le-manuel.html"><a href="notes-sur-le-manuel.html"><i class="fa fa-check"></i>Notes sur le manuel</a>
<ul>
<li class="chapter" data-level="" data-path="notes-sur-le-manuel.html"><a href="notes-sur-le-manuel.html#resources"><i class="fa fa-check"></i>Resources</a></li>
<li class="chapter" data-level="" data-path="notes-sur-le-manuel.html"><a href="notes-sur-le-manuel.html#licence"><i class="fa fa-check"></i>Licence</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I Open Science</b></span></li>
<li class="chapter" data-level="1" data-path="1-introduction-to-open-science.html"><a href="1-introduction-to-open-science.html"><i class="fa fa-check"></i><b>1</b> Introduction to open Science</a>
<ul>
<li class="chapter" data-level="1.1" data-path="1.1-why-do-we-need-it.html"><a href="1.1-why-do-we-need-it.html"><i class="fa fa-check"></i><b>1.1</b> Why do we need it?</a></li>
<li class="chapter" data-level="1.2" data-path="1.2-lecture.html"><a href="1.2-lecture.html"><i class="fa fa-check"></i><b>1.2</b> Lecture</a></li>
<li class="chapter" data-level="1.3" data-path="1.3-what-it-is.html"><a href="1.3-what-it-is.html"><i class="fa fa-check"></i><b>1.3</b> What it is?</a></li>
<li class="chapter" data-level="1.4" data-path="1.4-reproducible-code-and-analysis.html"><a href="1.4-reproducible-code-and-analysis.html"><i class="fa fa-check"></i><b>1.4</b> Reproducible code and analysis</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="2-introduction-to-rmarkdown.html"><a href="2-introduction-to-rmarkdown.html"><i class="fa fa-check"></i><b>2</b> Introduction to Rmarkdown</a>
<ul>
<li class="chapter" data-level="2.1" data-path="2.1-lecture-1.html"><a href="2.1-lecture-1.html"><i class="fa fa-check"></i><b>2.1</b> Lecture</a></li>
<li class="chapter" data-level="2.2" data-path="2.2-practical.html"><a href="2.2-practical.html"><i class="fa fa-check"></i><b>2.2</b> Practical</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="2.2-practical.html"><a href="2.2-practical.html#context"><i class="fa fa-check"></i><b>2.2.1</b> Context</a></li>
<li class="chapter" data-level="2.2.2" data-path="2.2-practical.html"><a href="2.2-practical.html#questions"><i class="fa fa-check"></i><b>2.2.2</b> Questions</a></li>
<li class="chapter" data-level="" data-path="2.2-practical.html"><a href="2.2-practical.html#example-of-output"><i class="fa fa-check"></i>Example of output</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-introduction-to-github-with-r.html"><a href="3-introduction-to-github-with-r.html"><i class="fa fa-check"></i><b>3</b> Introduction to github with R</a>
<ul>
<li class="chapter" data-level="3.1" data-path="3.1-lecture-2.html"><a href="3.1-lecture-2.html"><i class="fa fa-check"></i><b>3.1</b> Lecture</a></li>
<li class="chapter" data-level="3.2" data-path="3.2-practical-1.html"><a href="3.2-practical-1.html"><i class="fa fa-check"></i><b>3.2</b> Practical</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="3.2-practical-1.html"><a href="3.2-practical-1.html#context-1"><i class="fa fa-check"></i><b>3.2.1</b> Context</a></li>
<li class="chapter" data-level="3.2.2" data-path="3.2-practical-1.html"><a href="3.2-practical-1.html#information-of-the-data"><i class="fa fa-check"></i><b>3.2.2</b> Information of the data</a></li>
<li class="chapter" data-level="3.2.3" data-path="3.2-practical-1.html"><a href="3.2-practical-1.html#questions-1"><i class="fa fa-check"></i><b>3.2.3</b> Questions</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Statistics</b></span></li>
<li class="chapter" data-level="4" data-path="4-generalized-linear-model-glm.html"><a href="4-generalized-linear-model-glm.html"><i class="fa fa-check"></i><b>4</b> Generalized linear model, <code>glm</code></a>
<ul>
<li class="chapter" data-level="4.1" data-path="4.1-lecture-3.html"><a href="4.1-lecture-3.html"><i class="fa fa-check"></i><b>4.1</b> Lecture</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="4.1-lecture-3.html"><a href="4.1-lecture-3.html#distributions"><i class="fa fa-check"></i><b>4.1.1</b> Distributions</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="4.2-practical-2.html"><a href="4.2-practical-2.html"><i class="fa fa-check"></i><b>4.2</b> Practical</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="5-introduction-to-linear-mixed-models.html"><a href="5-introduction-to-linear-mixed-models.html"><i class="fa fa-check"></i><b>5</b> Introduction to linear mixed models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="5.1-lecture-4.html"><a href="5.1-lecture-4.html"><i class="fa fa-check"></i><b>5.1</b> Lecture</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="5.1-lecture-4.html"><a href="5.1-lecture-4.html#testing-fixed-effects"><i class="fa fa-check"></i><b>5.1.1</b> Testing fixed effects</a></li>
<li class="chapter" data-level="5.1.2" data-path="5.1-lecture-4.html"><a href="5.1-lecture-4.html#shrinkage"><i class="fa fa-check"></i><b>5.1.2</b> Shrinkage</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="5.2-practical-3.html"><a href="5.2-practical-3.html"><i class="fa fa-check"></i><b>5.2</b> Practical</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="5.2-practical-3.html"><a href="5.2-practical-3.html#overview"><i class="fa fa-check"></i><b>5.2.1</b> Overview</a></li>
<li class="chapter" data-level="5.2.2" data-path="5.2-practical-3.html"><a href="5.2-practical-3.html#r-packages-needed"><i class="fa fa-check"></i><b>5.2.2</b> R packages needed</a></li>
<li class="chapter" data-level="5.2.3" data-path="5.2-practical-3.html"><a href="5.2-practical-3.html#the-superb-wild-unicorns-of-the-scottish-highlands"><i class="fa fa-check"></i><b>5.2.3</b> The superb wild unicorns of the Scottish Highlands</a></li>
<li class="chapter" data-level="5.2.4" data-path="5.2-practical-3.html"><a href="5.2-practical-3.html#do-unicorns-differ-in-aggressiveness-your-first-mixed-model"><i class="fa fa-check"></i><b>5.2.4</b> Do unicorns differ in aggressiveness? Your first mixed model</a></li>
<li class="chapter" data-level="5.2.5" data-path="5.2-practical-3.html"><a href="5.2-practical-3.html#do-unicorns-differ-in-aggressiveness-a-better-mixed-model"><i class="fa fa-check"></i><b>5.2.5</b> Do unicorns differ in aggressiveness? A better mixed model</a></li>
<li class="chapter" data-level="5.2.6" data-path="5.2-practical-3.html"><a href="5.2-practical-3.html#what-is-the-repeatability"><i class="fa fa-check"></i><b>5.2.6</b> What is the repeatability?</a></li>
<li class="chapter" data-level="5.2.7" data-path="5.2-practical-3.html"><a href="5.2-practical-3.html#a-quick-note-on-uncertainty"><i class="fa fa-check"></i><b>5.2.7</b> A quick note on uncertainty</a></li>
<li class="chapter" data-level="5.2.8" data-path="5.2-practical-3.html"><a href="5.2-practical-3.html#an-easy-way-to-mess-up-your-mixed-models"><i class="fa fa-check"></i><b>5.2.8</b> An easy way to mess up your mixed models</a></li>
<li class="chapter" data-level="5.2.9" data-path="5.2-practical-3.html"><a href="5.2-practical-3.html#happy-mixed-modelling"><i class="fa fa-check"></i><b>5.2.9</b> Happy mixed-modelling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="6-introduction-to-glmm.html"><a href="6-introduction-to-glmm.html"><i class="fa fa-check"></i><b>6</b> Introduction to <code>GLMM</code></a>
<ul>
<li class="chapter" data-level="6.1" data-path="6.1-lecture-5.html"><a href="6.1-lecture-5.html"><i class="fa fa-check"></i><b>6.1</b> Lecture</a></li>
<li class="chapter" data-level="6.2" data-path="6.2-practical-4.html"><a href="6.2-practical-4.html"><i class="fa fa-check"></i><b>6.2</b> Practical</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="6.2-practical-4.html"><a href="6.2-practical-4.html#packages-and-functions"><i class="fa fa-check"></i><b>6.2.1</b> Packages and functions</a></li>
<li class="chapter" data-level="6.2.2" data-path="6.2-practical-4.html"><a href="6.2-practical-4.html#the-data-set"><i class="fa fa-check"></i><b>6.2.2</b> The data set</a></li>
<li class="chapter" data-level="6.2.3" data-path="6.2-practical-4.html"><a href="6.2-practical-4.html#specifying-fixed-and-random-effects"><i class="fa fa-check"></i><b>6.2.3</b> Specifying fixed and random Effects</a></li>
<li class="chapter" data-level="6.2.4" data-path="6.2-practical-4.html"><a href="6.2-practical-4.html#look-at-overall-patterns-in-data"><i class="fa fa-check"></i><b>6.2.4</b> Look at overall patterns in data</a></li>
<li class="chapter" data-level="6.2.5" data-path="6.2-practical-4.html"><a href="6.2-practical-4.html#choose-an-error-distribution"><i class="fa fa-check"></i><b>6.2.5</b> Choose an error distribution</a></li>
<li class="chapter" data-level="6.2.6" data-path="6.2-practical-4.html"><a href="6.2-practical-4.html#fitting-group-wise-glm"><i class="fa fa-check"></i><b>6.2.6</b> Fitting group-wise GLM</a></li>
<li class="chapter" data-level="6.2.7" data-path="6.2-practical-4.html"><a href="6.2-practical-4.html#fitting-and-evaluating-glmms"><i class="fa fa-check"></i><b>6.2.7</b> Fitting and evaluating GLMMs</a></li>
<li class="chapter" data-level="6.2.8" data-path="6.2-practical-4.html"><a href="6.2-practical-4.html#inference"><i class="fa fa-check"></i><b>6.2.8</b> Inference</a></li>
<li class="chapter" data-level="6.2.9" data-path="6.2-practical-4.html"><a href="6.2-practical-4.html#conclusions"><i class="fa fa-check"></i><b>6.2.9</b> Conclusions</a></li>
<li class="chapter" data-level="6.2.10" data-path="6.2-practical-4.html"><a href="6.2-practical-4.html#happy-generalized-mixed-modelling"><i class="fa fa-check"></i><b>6.2.10</b> Happy generalized mixed-modelling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="7-introduction-to-bayesian-inference.html"><a href="7-introduction-to-bayesian-inference.html"><i class="fa fa-check"></i><b>7</b> Introduction to <code>Bayesian Inference</code></a>
<ul>
<li class="chapter" data-level="7.1" data-path="7.1-lecture-6.html"><a href="7.1-lecture-6.html"><i class="fa fa-check"></i><b>7.1</b> Lecture</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="7.1-lecture-6.html"><a href="7.1-lecture-6.html#bayes-theorem"><i class="fa fa-check"></i><b>7.1.1</b> Bayes’ theorem</a></li>
<li class="chapter" data-level="7.1.2" data-path="7.1-lecture-6.html"><a href="7.1-lecture-6.html#intro-to-mcmc"><i class="fa fa-check"></i><b>7.1.2</b> Intro to MCMC</a></li>
<li class="chapter" data-level="7.1.3" data-path="7.1-lecture-6.html"><a href="7.1-lecture-6.html#inferences-1"><i class="fa fa-check"></i><b>7.1.3</b> Inferences</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="7.2-practical-5.html"><a href="7.2-practical-5.html"><i class="fa fa-check"></i><b>7.2</b> Practical</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="7.2-practical-5.html"><a href="7.2-practical-5.html#r-packages-needed-1"><i class="fa fa-check"></i><b>7.2.1</b> R packages needed</a></li>
<li class="chapter" data-level="7.2.2" data-path="7.2-practical-5.html"><a href="7.2-practical-5.html#a-refresher-on-unicorn-ecology"><i class="fa fa-check"></i><b>7.2.2</b> A refresher on unicorn ecology</a></li>
<li class="chapter" data-level="7.2.3" data-path="7.2-practical-5.html"><a href="7.2-practical-5.html#mcmcglmm"><i class="fa fa-check"></i><b>7.2.3</b> MCMCglmm</a></li>
<li class="chapter" data-level="7.2.4" data-path="7.2-practical-5.html"><a href="7.2-practical-5.html#inferences-2"><i class="fa fa-check"></i><b>7.2.4</b> Inferences</a></li>
<li class="chapter" data-level="7.2.5" data-path="7.2-practical-5.html"><a href="7.2-practical-5.html#brms"><i class="fa fa-check"></i><b>7.2.5</b> brms</a></li>
<li class="chapter" data-level="7.2.6" data-path="7.2-practical-5.html"><a href="7.2-practical-5.html#inferences-3"><i class="fa fa-check"></i><b>7.2.6</b> Inferences</a></li>
<li class="chapter" data-level="7.2.7" data-path="7.2-practical-5.html"><a href="7.2-practical-5.html#happy-bayesian-stats"><i class="fa fa-check"></i><b>7.2.7</b> Happy Bayesian stats</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="8-multivariate-mixed-models.html"><a href="8-multivariate-mixed-models.html"><i class="fa fa-check"></i><b>8</b> Multivariate mixed models</a>
<ul>
<li class="chapter" data-level="8.1" data-path="8.1-lecture-7.html"><a href="8.1-lecture-7.html"><i class="fa fa-check"></i><b>8.1</b> Lecture</a></li>
<li class="chapter" data-level="8.2" data-path="8.2-practical-6.html"><a href="8.2-practical-6.html"><i class="fa fa-check"></i><b>8.2</b> Practical</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="8.2-practical-6.html"><a href="8.2-practical-6.html#r-packages-needed-2"><i class="fa fa-check"></i><b>8.2.1</b> R packages needed</a></li>
<li class="chapter" data-level="8.2.2" data-path="8.2-practical-6.html"><a href="8.2-practical-6.html#the-blue-dragon-of-the-east"><i class="fa fa-check"></i><b>8.2.2</b> The blue dragon of the East</a></li>
<li class="chapter" data-level="8.2.3" data-path="8.2-practical-6.html"><a href="8.2-practical-6.html#multiple-univariate-models"><i class="fa fa-check"></i><b>8.2.3</b> Multiple univariate models</a></li>
<li class="chapter" data-level="8.2.4" data-path="8.2-practical-6.html"><a href="8.2-practical-6.html#multivariate-approach"><i class="fa fa-check"></i><b>8.2.4</b> Multivariate approach</a></li>
<li class="chapter" data-level="8.2.5" data-path="8.2-practical-6.html"><a href="8.2-practical-6.html#happy-multivariate-models"><i class="fa fa-check"></i><b>8.2.5</b> Happy multivariate models</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="9-random-regression-and-character-state-approaches.html"><a href="9-random-regression-and-character-state-approaches.html"><i class="fa fa-check"></i><b>9</b> Random regression and character state approaches</a>
<ul>
<li class="chapter" data-level="9.1" data-path="9.1-lecture-8.html"><a href="9.1-lecture-8.html"><i class="fa fa-check"></i><b>9.1</b> Lecture</a></li>
<li class="chapter" data-level="9.2" data-path="9.2-practical-7.html"><a href="9.2-practical-7.html"><i class="fa fa-check"></i><b>9.2</b> Practical</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="9.2-practical-7.html"><a href="9.2-practical-7.html#r-packages-needed-3"><i class="fa fa-check"></i><b>9.2.1</b> R packages needed</a></li>
<li class="chapter" data-level="9.2.2" data-path="9.2-practical-7.html"><a href="9.2-practical-7.html#refresher-on-unicorn-aggression"><i class="fa fa-check"></i><b>9.2.2</b> Refresher on unicorn aggression</a></li>
<li class="chapter" data-level="9.2.3" data-path="9.2-practical-7.html"><a href="9.2-practical-7.html#random-regression"><i class="fa fa-check"></i><b>9.2.3</b> Random regression</a></li>
<li class="chapter" data-level="9.2.4" data-path="9.2-practical-7.html"><a href="9.2-practical-7.html#character-state-approach"><i class="fa fa-check"></i><b>9.2.4</b> Character-State approach</a></li>
<li class="chapter" data-level="9.2.5" data-path="9.2-practical-7.html"><a href="9.2-practical-7.html#from-random-regression-to-character-state"><i class="fa fa-check"></i><b>9.2.5</b> From random regression to character-state</a></li>
<li class="chapter" data-level="9.2.6" data-path="9.2-practical-7.html"><a href="9.2-practical-7.html#conclusions-2"><i class="fa fa-check"></i><b>9.2.6</b> Conclusions</a></li>
<li class="chapter" data-level="9.2.7" data-path="9.2-practical-7.html"><a href="9.2-practical-7.html#happy-multivariate-models-1"><i class="fa fa-check"></i><b>9.2.7</b> Happy multivariate models</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="10-beyong-p-0.html"><a href="10-beyong-p-0.html"><i class="fa fa-check"></i><b>10</b> Beyong <em>P &lt; 0.05</em></a></li>
<li class="part"><span><b>III Appendix</b></span></li>
<li class="chapter" data-level="" data-path="r-1.html"><a href="r-1.html"><i class="fa fa-check"></i>R</a></li>
<li class="chapter" data-level="" data-path="to-do-list.html"><a href="to-do-list.html"><i class="fa fa-check"></i>To do list</a>
<ul>
<li class="chapter" data-level="10.1" data-path="10.1-potential-structure.html"><a href="10.1-potential-structure.html"><i class="fa fa-check"></i><b>10.1</b> potential structure</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="_blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">BIO8940 Advanced stats and Open Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="practical-3" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Practical</h2>
<div id="overview" class="section level3" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Overview</h3>
<p>This practical is intended to get you started fitting some simple mixed models with so called <em>random intercepts</em>. The tutorial is derived from one that accompanied the paper <span class="citation">(Houslay and Wilson <a href="#ref-houslay_avoiding_2017" role="doc-biblioref">2017</a>)</span>, “<a href="https://doi.org/10.1093/beheco/arx023">Avoiding the misuse of BLUP in behavioral ecology</a>”. Here, you will be working through a simplified version in which I have taken more time to cover the basic mixed models and don’t cover multivariate models which were really the main point of that paper. So if you find this material interesting don’t worry we will go through a more advanced version of the original paper on multivariate models in <a href="#to_be_written">chapter XX</a>. The original version will be worth a work through to help you break into multivariate mixed models anyway! Here we will:</p>
<ul>
<li>Learn how to fit - and interpret the results of - a simple univariate mixed effect model</li>
<li>See how to add fixed and random effects to your model, and to test their significance in the normal frequentists sense</li>
</ul>
<!-- * Use random regression or random slope models as extensions of the simple mixed model. We will do this in a hypothetical investigation of  behavioural plasticity, adopting a 'reaction norm perspective' and asking whether individuals differ in phenotypic plasticity (a phenomenon sometimes called IxE)
 * Try and flag some common pitfalls with random regression models, and in particular show you why you need to be careful interpreting effect sizes and why you need to think a bit about if (and how) to scale and centre covariates.
 * Finally, as a lead in why you really should learn about multivariate models after this, we will highlight how character state views of plasticity are really just approximations of multivariate 'character state' approaches. This is a bit mind blowing at first, but once you understand you will start to see just how far the rabbit hole goes...
 -->
<p>We are going to use the 📦 <code>lme4</code> <span class="citation">(Bates et al. <a href="#ref-R-lme4" role="doc-biblioref">2021</a>)</span> which is widely used and great for simple mixed models. However, since, for philosophical reasons, <code>lme4</code> does not provide any p-values for either fixed or random effects, we are going to use the 📦 <code>lmerTest</code> <span class="citation">(Kuznetsova et al. <a href="#ref-R-lmerTest" role="doc-biblioref">2020</a>)</span>, which add a bunch a nice goodies to <code>lme4</code> For slightly more complex models, including multivariate ones, generalised models, and random effects of things like shared space, pedigree, phylogeny I tend to use different 📦 like <code>MCMCglmm</code> <span class="citation">(Hadfield <a href="#ref-MCMCglmm2010" role="doc-biblioref">2010</a>)</span> (which is Bayesian, look at Jarrod Hadfield’s excellent course notes <span class="citation">(Hadfield <a href="#ref-R-MCMCglmm" role="doc-biblioref">2022</a>)</span>) or ASReml-R <span class="citation">(Butler <a href="#ref-R-asreml" role="doc-biblioref">2021</a>)</span> (which is likelihood based/frequentist but sadly is not free).</p>
<!-- Further data sets and tutorials written by Tom can be found at [https://tomhouslay.com/tutorials/](https://tomhouslay.com/tutorials/). -->
</div>
<div id="r-packages-needed" class="section level3" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> R packages needed</h3>
<p>First we load required libraries</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="5.2-practical-3.html#cb22-1" aria-hidden="true"></a><span class="kw">library</span>(lmerTest)</span>
<span id="cb22-2"><a href="5.2-practical-3.html#cb22-2" aria-hidden="true"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb22-3"><a href="5.2-practical-3.html#cb22-3" aria-hidden="true"></a><span class="kw">library</span>(rptR)</span></code></pre></div>
</div>
<div id="the-superb-wild-unicorns-of-the-scottish-highlands" class="section level3" number="5.2.3">
<h3><span class="header-section-number">5.2.3</span> The superb wild unicorns of the Scottish Highlands</h3>
<p>Unicorns, a legendary animal and also symbol or Scotland, are frequently described as extremely wild woodland creature but also a symbol of purity and grace. Here is one of most accurate representation of the lengendary animal.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-20"></span>
<img src="images/unicorn.png" alt="The superb unicorn of the Scottish Highlands" width="50%" />
<p class="caption">
Figure 5.1: The superb unicorn of the Scottish Highlands
</p>
</div>
<p>Despite their image of purity and grace, unicorns (<em>Unicornus legendaricus</em>) are raging fighter when it comes to compete for the best sweets you can find at the bottom of rainbows (unicorn favourite source of food).</p>
<p>We want to know:</p>
<ul>
<li>If aggressiveness differs among individuals</li>
<li>If aggressive behaviour is plastic (change with the environment)</li>
<li>If aggressive behaviour depends on body condition of focal animal
<!-- * If individuals differ in their plasticity --></li>
</ul>
<p>With respect to plasticity, we will focus on rival size as an ‘environment’. Common sense, and animal-contest theory, suggest a small animal would be wise not to escalate an aggressive contest against a larger, stronger rival. However, there are reports in the legendary beasty literature that they get more aggressive as rival size increases. Those reports are based on small sample sizes and uncontrolled field observations by foreigners Munro baggers enjoying their whisky after a long day in the hills.</p>
<div id="experimental-design" class="section level4" number="5.2.3.1">
<h4><span class="header-section-number">5.2.3.1</span> Experimental design</h4>
<p>Here, we have measured aggression in a population of wild unicorns. We brought some (n=80) individual into the lab, tagged them so they were individually identifiable, then repeatedly observed their aggression when presented with model ‘intruders’ (animal care committe approved). There were three models; one of average unicorn (calculated as the population mean body length), one that was build to be 1 standard deviation below the population mean, and one that was 1 standard deviation above.</p>
<p>Data were collected on all individuals in two block of lab work. Within each block, each animal was tested 3 times, once against an ‘intruder’ of each size. The test order in which each animal experienced the three instruder sizes was randomised in each block. The body size of all focal individuals was measured at the beginning of each block so we know that too (and have two separate measures per individual).</p>
</div>
<div id="looking-at-the-data" class="section level4" number="5.2.3.2">
<h4><span class="header-section-number">5.2.3.2</span> looking at the data</h4>
<p>Let’s load the data file <code>unicorns_aggression.csv</code> in a R object named <code>unicorns</code> and make sure we understand what it contains</p>
<div class="exer">
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="5.2-practical-3.html#cb23-1" aria-hidden="true"></a>unicorns &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/unicorns_aggression.csv&quot;</span>)</span></code></pre></div>
<p>You can use <code>summary(unicorns)</code> to get an overview of the data and/or <code>str(unicorns)</code> to see the structure in the first few lines. This data frame has 6 variables:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="5.2-practical-3.html#cb24-1" aria-hidden="true"></a><span class="kw">str</span>(unicorns)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    480 obs. of  6 variables:
##  $ ID        : chr  &quot;ID_1&quot; &quot;ID_1&quot; &quot;ID_1&quot; &quot;ID_1&quot; ...
##  $ block     : num  -0.5 -0.5 -0.5 0.5 0.5 0.5 -0.5 -0.5 -0.5 0.5 ...
##  $ assay_rep : int  1 2 3 1 2 3 1 2 3 1 ...
##  $ opp_size  : int  -1 1 0 0 1 -1 1 -1 0 1 ...
##  $ aggression: num  7.02 10.67 10.22 8.95 10.51 ...
##  $ body_size : num  206 206 206 207 207 ...</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="5.2-practical-3.html#cb26-1" aria-hidden="true"></a><span class="kw">summary</span>(unicorns)</span></code></pre></div>
<pre><code>##       ID                block        assay_rep
##  Length:480         Min.   :-0.5   Min.   :1  
##  Class :character   1st Qu.:-0.5   1st Qu.:1  
##  Mode  :character   Median : 0.0   Median :2  
##                     Mean   : 0.0   Mean   :2  
##                     3rd Qu.: 0.5   3rd Qu.:3  
##                     Max.   : 0.5   Max.   :3  
##     opp_size    aggression       body_size    
##  Min.   :-1   Min.   : 5.900   Min.   :192.0  
##  1st Qu.:-1   1st Qu.: 8.158   1st Qu.:229.7  
##  Median : 0   Median : 8.950   Median :250.0  
##  Mean   : 0   Mean   : 9.002   Mean   :252.5  
##  3rd Qu.: 1   3rd Qu.: 9.822   3rd Qu.:272.0  
##  Max.   : 1   Max.   :12.170   Max.   :345.2</code></pre>
</div>
<p>So the different columns in the data set are:</p>
<ul>
<li>Individual <strong>ID</strong></li>
<li>Experimental <strong>Block</strong>, denoted for now as a continuous variable with possible values of -0.5 (first block) or +0.5 (second block)</li>
<li>Individual <strong>body_size</strong>, as measured at the start of each block in kg</li>
<li>The repeat number for each behavioural test, <strong>assay_rep</strong></li>
<li>Opponent size (<strong>opp_size</strong>), in standard deviations from the mean (i.e., -1,0,1)</li>
<li><strong>aggression</strong>, our behavioural trait, measured 6 times in total per individual (2 blocks of 3 tests)</li>
</ul>
<p><em>maybe add something on how to look at data structure closely using tables</em></p>
</div>
</div>
<div id="do-unicorns-differ-in-aggressiveness-your-first-mixed-model" class="section level3" number="5.2.4">
<h3><span class="header-section-number">5.2.4</span> Do unicorns differ in aggressiveness? Your first mixed model</h3>
<p>Fit a first mixed model with <code>lmer</code> that have only individual identity as a random effect and only a population mean.</p>
<p>Why, so simple? Because we simply want to partition variance around the mean into a component that among-individual variance and one that is within-individual variance.</p>
<div class="exer">
<p>A sensible researcher would probably take the time to do some exploratory data plots here. So let’s write a mixed model. This one is going to have no fixed effects except the mean, and just one random effect - individual identity.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="5.2-practical-3.html#cb28-1" aria-hidden="true"></a>m_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">lmer</span>(aggression <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>ID), <span class="dt">data =</span> unicorns)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<p>There is a warning… something about “singularities”. Ignore that for a moment.</p>
</div>
<p>Now you need to get the model output. By that I just mean use <code>summary(model_name)</code>.</p>
<div class="exer">
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="5.2-practical-3.html#cb30-1" aria-hidden="true"></a><span class="kw">summary</span>(m_<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML. t-tests use
##   Satterthwaite&#39;s method [lmerModLmerTest]
## Formula: aggression ~ 1 + (1 | ID)
##    Data: unicorns
## 
## REML criterion at convergence: 1503.7
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -2.68530 -0.73094 -0.04486  0.71048  2.74276 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  ID       (Intercept) 0.000    0.000   
##  Residual             1.334    1.155   
## Number of obs: 480, groups:  ID, 80
## 
## Fixed effects:
##              Estimate Std. Error        df t value
## (Intercept)   9.00181    0.05272 479.00000   170.7
##             Pr(&gt;|t|)    
## (Intercept)   &lt;2e-16 ***
## ---
## Signif. codes:  
## 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## optimizer (nloptwrap) convergence code: 0 (OK)
## boundary (singular) fit: see ?isSingular</code></pre>
</div>
<p>In the summary you will find a table of fixed effects.</p>
<pre><code>Fixed effects:
             Estimate Std. Error        df t value Pr(&gt;|t|)    
(Intercept)   9.00181    0.05272 479.00000   170.7   &lt;2e-16 ***</code></pre>
<p>The intercept (here the mean) is about 9 and is significantly &gt;0 - fine, but not very interesting to us.</p>
<p>You will also find a random effect table that contains estimates of the among individual (ID) and residual variances.</p>
<pre><code>Random effects:
 Groups   Name        Variance Std.Dev.
 ID       (Intercept) 0.000    0.000   
 Residual             1.334    1.155   
Number of obs: 480, groups:  ID, 80</code></pre>
<p>The among individual (ID) is estimated as zero. In fact this is what the cryptic warning was about: in most situations the idea of a random effect explaining less than zero variance is not sensible (strangely there are exception!). So by default the variance estimates are constrained to lie in positive parameter space. Here in trying to find the maximum likelihood solution for among-individual variance, our model has run up against this constraint.</p>
<div id="testing-for-random-effects" class="section level4" number="5.2.4.1">
<h4><span class="header-section-number">5.2.4.1</span> Testing for random effects</h4>
<p>We can test the statistical significance of the random effect using the <code>ranova()</code> command in <code>lmerTest</code>. This function is actually doing a <em>likelihood ratio test</em> (LRT) of the random effect. The premise of which is that twice the difference in log-likelihood of the full and reduced (i.e. with the random effect dropped) is itself distributed as <span class="math inline">\(\chi^2\)</span>$ with DF equal to the number of parameters dropped (here 1). Actually, there is a good argument that this is too conservative, but we can discuss that later. So let’s do the LRT for the random effect using <code>ranova()</code></p>
<div class="exer">
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="5.2-practical-3.html#cb34-1" aria-hidden="true"></a><span class="kw">ranova</span>(m_<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## ANOVA-like table for random-effects: Single term deletions
## 
## Model:
## aggression ~ (1 | ID)
##          npar  logLik    AIC LRT Df Pr(&gt;Chisq)
## &lt;none&gt;      3 -751.83 1509.7                  
## (1 | ID)    2 -751.83 1507.7   0  1          1</code></pre>
</div>
<p>There is apparently no among-individual variance in aggressiveness.</p>
<p>So this is a fairly rubbish and underwhelming model. Let’s improve it.</p>
</div>
</div>
<div id="do-unicorns-differ-in-aggressiveness-a-better-mixed-model" class="section level3" number="5.2.5">
<h3><span class="header-section-number">5.2.5</span> Do unicorns differ in aggressiveness? A better mixed model</h3>
<p>The answer we got from our first model is <strong>not</strong> wrong, it estimated the parameters we asked for and that might be informative or not and that might be representative or not of the true biology. Anyway all models are <strong>wrong</strong> but as models go this one is fairly rubbish. In fact we have explained no variation at all as we have no fixed effects (except the mean) and our random effect variance is zero. We woud have seen just how pointless this model was if we’d plotted it</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="5.2-practical-3.html#cb36-1" aria-hidden="true"></a><span class="kw">plot</span>(m_<span class="dv">1</span>)</span></code></pre></div>
<div class="figure">
<img src="BIO8940_book_files/figure-html/mod1_plot-1.svg" alt="Fitted values vs residuals for a simple mixed model of unicorn aggression" width="672" />
<p class="caption">
(#fig:mod1_plot)Fitted values vs residuals for a simple mixed model of unicorn aggression
</p>
</div>
<p>So we can probably do better at modelling the data, which may or may not change our view on whether there is any real variation among unicorns in aggressiveness.</p>
<p>For instance, we can (and should have started with) an initial plot of the phenotypic data against opponent size indicates to have a look at our prediction.</p>
<div class="exer">
<p>The code below uses the excellent 📦 <code>ggplot2</code> but the same figure can be done using base R code.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="5.2-practical-3.html#cb37-1" aria-hidden="true"></a><span class="kw">ggplot</span>(unicorns, <span class="kw">aes</span>(<span class="dt">x =</span> opp_size, <span class="dt">y =</span> aggression)) <span class="op">+</span></span>
<span id="cb37-2"><a href="5.2-practical-3.html#cb37-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_jitter</span>(</span>
<span id="cb37-3"><a href="5.2-practical-3.html#cb37-3" aria-hidden="true"></a>    <span class="dt">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb37-4"><a href="5.2-practical-3.html#cb37-4" aria-hidden="true"></a>    <span class="dt">width =</span> <span class="fl">0.05</span></span>
<span id="cb37-5"><a href="5.2-practical-3.html#cb37-5" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb37-6"><a href="5.2-practical-3.html#cb37-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb37-7"><a href="5.2-practical-3.html#cb37-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb37-8"><a href="5.2-practical-3.html#cb37-8" aria-hidden="true"></a>    <span class="dt">x =</span> <span class="st">&quot;Opponent size (SD)&quot;</span>,</span>
<span id="cb37-9"><a href="5.2-practical-3.html#cb37-9" aria-hidden="true"></a>    <span class="dt">y =</span> <span class="st">&quot;Aggression&quot;</span></span>
<span id="cb37-10"><a href="5.2-practical-3.html#cb37-10" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb37-11"><a href="5.2-practical-3.html#cb37-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme_classic</span>()</span></code></pre></div>
</div>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="5.2-practical-3.html#cb38-1" aria-hidden="true"></a><span class="kw">ggplot</span>(unicorns, <span class="kw">aes</span>(<span class="dt">x =</span> opp_size, <span class="dt">y =</span> aggression)) <span class="op">+</span></span>
<span id="cb38-2"><a href="5.2-practical-3.html#cb38-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_jitter</span>(</span>
<span id="cb38-3"><a href="5.2-practical-3.html#cb38-3" aria-hidden="true"></a>    <span class="dt">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb38-4"><a href="5.2-practical-3.html#cb38-4" aria-hidden="true"></a>    <span class="dt">width =</span> <span class="fl">0.05</span></span>
<span id="cb38-5"><a href="5.2-practical-3.html#cb38-5" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb38-6"><a href="5.2-practical-3.html#cb38-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb38-7"><a href="5.2-practical-3.html#cb38-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb38-8"><a href="5.2-practical-3.html#cb38-8" aria-hidden="true"></a>    <span class="dt">x =</span> <span class="st">&quot;Opponent size (SD)&quot;</span>,</span>
<span id="cb38-9"><a href="5.2-practical-3.html#cb38-9" aria-hidden="true"></a>    <span class="dt">y =</span> <span class="st">&quot;Aggression&quot;</span></span>
<span id="cb38-10"><a href="5.2-practical-3.html#cb38-10" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb38-11"><a href="5.2-practical-3.html#cb38-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme_classic</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:rplotaggr"></span>
<img src="BIO8940_book_files/figure-html/rplotaggr-1.svg" alt="Unicorn aggressivity as a function of opponent size when fighting for sweets" width="672" />
<p class="caption">
Figure 5.2: Unicorn aggressivity as a function of opponent size when fighting for sweets
</p>
</div>
<p>As predicted, there is a general increase in aggression with opponent size (points are lightly jittered on the x-axis to show the spread of data a little better)</p>
<p>You can see the same thing from a quick look at the population means for aggression at opponent size. Here we do it with the <code>kable</code> function that makes nice tables in <code>rmarkdown</code> documents.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="5.2-practical-3.html#cb39-1" aria-hidden="true"></a>unicorns <span class="op">%&gt;%</span></span>
<span id="cb39-2"><a href="5.2-practical-3.html#cb39-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(opp_size) <span class="op">%&gt;%</span></span>
<span id="cb39-3"><a href="5.2-practical-3.html#cb39-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_aggr =</span> <span class="kw">mean</span>(aggression)) <span class="op">%&gt;%</span></span>
<span id="cb39-4"><a href="5.2-practical-3.html#cb39-4" aria-hidden="true"></a><span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">opp_size</th>
<th align="right">mean_aggr</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">-1</td>
<td align="right">8.00</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">8.91</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">10.09</td>
</tr>
</tbody>
</table>
<p>So, there does appear to be plasticity of aggression with changing size of the model opponent. But other things may explain variation in aggressiveness too - what about block for instance? Block effects may not be the subject of any biologically interesting hypotheses, but accounting for any differences between blocks could remove noise.</p>
<p>There may also be systematic change in behaviour as an individual experiences more repeat observations (i.e. exposure to the model). Do they get sensitised or habituated to the model intruder for example?</p>
<p>So let’s run a mixed model with the same random effect of individual, but with a fixed effects of opponent size (our predictor of interest) and experimental block.</p>
<div class="exer">
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="5.2-practical-3.html#cb40-1" aria-hidden="true"></a>m_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">lmer</span>(aggression <span class="op">~</span><span class="st"> </span>opp_size <span class="op">+</span><span class="st"> </span>block <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>ID), <span class="dt">data =</span> unicorns)</span></code></pre></div>
</div>
<div id="diagnostic-plots" class="section level4" number="5.2.5.1">
<h4><span class="header-section-number">5.2.5.1</span> Diagnostic plots</h4>
<p>Run a few diagnostic plots before we look at the answers. In diagnostic plots, we want to check the condition of applications of the linear mixed model which are the same 4 as the linear model plus 2 extra:</p>
<ol style="list-style-type: decimal">
<li><p>Linearity of the relation between covariates and the response</p></li>
<li><p>No error on measurement of covariates</p></li>
<li><p>Residual have a Gaussian distribution</p></li>
<li><p>Homoscedasticty (variance of residuals is constant across covariates)</p></li>
<li><p>Random effects have a Gaussian distribution</p></li>
<li><p>Residual variance is constant across all levels of a random effect</p></li>
</ol>
<div class="exer">
<p>This is checked with:</p>
<ol style="list-style-type: decimal">
<li>done with data exploration graph (i.e. just plot the data see if it is linear)
<ul>
<li>see previous graph</li>
</ul></li>
<li>assumed to be correct if measurement error is lower than 10% of variance in the variable
<ul>
<li>I know this sounds pretty bad</li>
</ul></li>
<li>using quantile-quantile plot or histogram of residuals</li>
</ol>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="5.2-practical-3.html#cb41-1" aria-hidden="true"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)) <span class="co"># multiple graphs in a window</span></span>
<span id="cb41-2"><a href="5.2-practical-3.html#cb41-2" aria-hidden="true"></a><span class="kw">qqnorm</span>(<span class="kw">residuals</span>(m_<span class="dv">2</span>)) <span class="co"># a q-q plot</span></span>
<span id="cb41-3"><a href="5.2-practical-3.html#cb41-3" aria-hidden="true"></a><span class="kw">qqline</span>(<span class="kw">residuals</span>(m_<span class="dv">2</span>))</span>
<span id="cb41-4"><a href="5.2-practical-3.html#cb41-4" aria-hidden="true"></a><span class="kw">hist</span>(<span class="kw">resid</span>(m_<span class="dv">2</span>)) <span class="co"># are the residuals roughly Gaussian?</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-22"></span>
<img src="BIO8940_book_files/figure-html/unnamed-chunk-22-1.svg" alt="Checking residuals have Gaussian distribution" width="672" />
<p class="caption">
Figure 5.3: Checking residuals have Gaussian distribution
</p>
</div>
<ol start="4" style="list-style-type: decimal">
<li>using plot of residuals by fitted values</li>
</ol>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="5.2-practical-3.html#cb42-1" aria-hidden="true"></a><span class="kw">plot</span>(m_<span class="dv">2</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-23"></span>
<img src="BIO8940_book_files/figure-html/unnamed-chunk-23-1.svg" alt="Residuals by fitted values for model m_2 to check homoscedasticity" width="672" />
<p class="caption">
Figure 5.4: Residuals by fitted values for model m_2 to check homoscedasticity
</p>
</div>
<ol start="5" style="list-style-type: decimal">
<li>histogram of the predictions for the random effects (BLUPs)</li>
</ol>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="5.2-practical-3.html#cb43-1" aria-hidden="true"></a><span class="co"># extracting blups</span></span>
<span id="cb43-2"><a href="5.2-practical-3.html#cb43-2" aria-hidden="true"></a>r1 &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">ranef</span>(m_<span class="dv">2</span>, <span class="dt">condVar =</span> <span class="ot">TRUE</span>))</span>
<span id="cb43-3"><a href="5.2-practical-3.html#cb43-3" aria-hidden="true"></a></span>
<span id="cb43-4"><a href="5.2-practical-3.html#cb43-4" aria-hidden="true"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb43-5"><a href="5.2-practical-3.html#cb43-5" aria-hidden="true"></a><span class="kw">hist</span>(r1<span class="op">$</span>condval)</span>
<span id="cb43-6"><a href="5.2-practical-3.html#cb43-6" aria-hidden="true"></a><span class="kw">qqnorm</span>(r1<span class="op">$</span>condval)</span>
<span id="cb43-7"><a href="5.2-practical-3.html#cb43-7" aria-hidden="true"></a><span class="kw">qqline</span>(r1<span class="op">$</span>condval)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-24"></span>
<img src="BIO8940_book_files/figure-html/unnamed-chunk-24-1.svg" alt="Checking random effects are gaussian" width="672" />
<p class="caption">
Figure 5.5: Checking random effects are gaussian
</p>
</div>
<ol start="6" style="list-style-type: decimal">
<li>plotting the sorted BLUPs with their errors</li>
</ol>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="5.2-practical-3.html#cb44-1" aria-hidden="true"></a>r1 &lt;-<span class="st"> </span>r1[<span class="kw">order</span>(r1<span class="op">$</span>condval), ] <span class="co"># sorting the BLUPs</span></span>
<span id="cb44-2"><a href="5.2-practical-3.html#cb44-2" aria-hidden="true"></a><span class="kw">ggplot</span>(r1, <span class="kw">aes</span>(<span class="dt">y =</span> grp, <span class="dt">x =</span> condval)) <span class="op">+</span></span>
<span id="cb44-3"><a href="5.2-practical-3.html#cb44-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb44-4"><a href="5.2-practical-3.html#cb44-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_pointrange</span>(</span>
<span id="cb44-5"><a href="5.2-practical-3.html#cb44-5" aria-hidden="true"></a>    <span class="kw">aes</span>(<span class="dt">xmin =</span> condval <span class="op">-</span><span class="st"> </span>condsd <span class="op">*</span><span class="st"> </span><span class="fl">1.96</span>, <span class="dt">xmax =</span> condval <span class="op">+</span><span class="st"> </span>condsd <span class="op">*</span><span class="st"> </span><span class="fl">1.96</span>)</span>
<span id="cb44-6"><a href="5.2-practical-3.html#cb44-6" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb44-7"><a href="5.2-practical-3.html#cb44-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>)) <span class="op">+</span></span>
<span id="cb44-8"><a href="5.2-practical-3.html#cb44-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme_classic</span>() <span class="op">+</span></span>
<span id="cb44-9"><a href="5.2-practical-3.html#cb44-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="BIO8940_book_files/figure-html/mod2_plots-1.svg" width="672" /></p>
</div>
</div>
<div id="inferences" class="section level4" number="5.2.5.2">
<h4><span class="header-section-number">5.2.5.2</span> Inferences</h4>
<p><strong>Now summarise this model. We will pause here for you to think about and discuss a few things:</strong>
* What can you take from the fixed effect table?
* How do you interpret the intercept now that there are other effects in the model?
* What would happen if we scaled our fixed covariates differently? Why?</p>
<div class="exer">
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="5.2-practical-3.html#cb45-1" aria-hidden="true"></a><span class="kw">summary</span>(m_<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML. t-tests use
##   Satterthwaite&#39;s method [lmerModLmerTest]
## Formula: aggression ~ opp_size + block + (1 | ID)
##    Data: unicorns
## 
## REML criterion at convergence: 1129.9
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -2.79296 -0.64761  0.00155  0.67586  2.71456 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  ID       (Intercept) 0.02478  0.1574  
##  Residual             0.58166  0.7627  
## Number of obs: 480, groups:  ID, 80
## 
## Fixed effects:
##              Estimate Std. Error        df t value
## (Intercept)   9.00181    0.03901  79.00000 230.778
## opp_size      1.04562    0.04263 398.00000  24.525
## block        -0.02179    0.06962 398.00000  -0.313
##             Pr(&gt;|t|)    
## (Intercept)   &lt;2e-16 ***
## opp_size      &lt;2e-16 ***
## block          0.754    
## ---
## Signif. codes:  
## 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##          (Intr) opp_sz
## opp_size 0.000        
## block    0.000  0.000</code></pre>
</div>

<div class="rmdcode">
<p><strong>Try tweaking the fixed part of your model:</strong></p>
<ul>
<li>What happens if you add more fixed effects? Try it!</li>
<li>Could focal body size also matter? If so, should you rescale before adding it to the model?</li>
<li>Should you add interactions (e.g. block:opp_size)?</li>
<li>Should you drop non-significant fixed effects?</li>
</ul>
</div>

<div class="rmdcode">
<p><strong>Having changed the fixed part of your model, do the variance estimates change at all?</strong></p>
<ul>
<li>Is among-individual variance always estimated as zero regardless of fixed effects?</li>
<li>Is among-individual variance significant with some fixed effets structures but not others?</li>
</ul>
</div>
</div>
</div>
<div id="what-is-the-repeatability" class="section level3" number="5.2.6">
<h3><span class="header-section-number">5.2.6</span> What is the repeatability?</h3>
<p>As a reminder, repeatability is the proportion of variance explained by a random effect and it is estimate as the ratio of the variance associated to a random effect by the total variance, or the sum of the residual variance and the different variance compoentn associated with the random effects.
In our first model among-individual variance was zero, so R was zero. If we have a different model of aggression and get a non-zero value of the random effect variance, we can obviously calculate a repeatability estimate (R). So we are all working from the same starting point, let’s all stick with a common set of fixed effects from here on:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="5.2-practical-3.html#cb47-1" aria-hidden="true"></a>m_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">lmer</span>(</span>
<span id="cb47-2"><a href="5.2-practical-3.html#cb47-2" aria-hidden="true"></a>  aggression <span class="op">~</span><span class="st"> </span>opp_size <span class="op">+</span><span class="st"> </span><span class="kw">scale</span>(body_size, <span class="dt">center =</span> <span class="ot">TRUE</span>, <span class="dt">scale =</span> <span class="ot">TRUE</span>)</span>
<span id="cb47-3"><a href="5.2-practical-3.html#cb47-3" aria-hidden="true"></a>    <span class="op">+</span><span class="st"> </span><span class="kw">scale</span>(assay_rep, <span class="dt">scale =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span>block</span>
<span id="cb47-4"><a href="5.2-practical-3.html#cb47-4" aria-hidden="true"></a>    <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>ID),</span>
<span id="cb47-5"><a href="5.2-practical-3.html#cb47-5" aria-hidden="true"></a>  <span class="dt">data =</span> unicorns</span>
<span id="cb47-6"><a href="5.2-practical-3.html#cb47-6" aria-hidden="true"></a>)</span>
<span id="cb47-7"><a href="5.2-practical-3.html#cb47-7" aria-hidden="true"></a><span class="kw">summary</span>(m_<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML. t-tests use
##   Satterthwaite&#39;s method [lmerModLmerTest]
## Formula: 
## aggression ~ opp_size + scale(body_size, center = TRUE, scale = TRUE) +  
##     scale(assay_rep, scale = FALSE) + block + (1 | ID)
##    Data: unicorns
## 
## REML criterion at convergence: 1136.5
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -2.85473 -0.62831  0.02545  0.68998  2.74064 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  ID       (Intercept) 0.02538  0.1593  
##  Residual             0.58048  0.7619  
## Number of obs: 480, groups:  ID, 80
## 
## Fixed effects:
##                                                Estimate
## (Intercept)                                     9.00181
## opp_size                                        1.05141
## scale(body_size, center = TRUE, scale = TRUE)   0.03310
## scale(assay_rep, scale = FALSE)                -0.05783
## block                                          -0.02166
##                                               Std. Error
## (Intercept)                                      0.03907
## opp_size                                         0.04281
## scale(body_size, center = TRUE, scale = TRUE)    0.03896
## scale(assay_rep, scale = FALSE)                  0.04281
## block                                            0.06955
##                                                      df
## (Intercept)                                    78.07315
## opp_size                                      396.99857
## scale(body_size, center = TRUE, scale = TRUE)  84.21144
## scale(assay_rep, scale = FALSE)               396.99857
## block                                         397.00209
##                                               t value
## (Intercept)                                   230.395
## opp_size                                       24.562
## scale(body_size, center = TRUE, scale = TRUE)   0.850
## scale(assay_rep, scale = FALSE)                -1.351
## block                                          -0.311
##                                               Pr(&gt;|t|)    
## (Intercept)                                     &lt;2e-16 ***
## opp_size                                        &lt;2e-16 ***
## scale(body_size, center = TRUE, scale = TRUE)    0.398    
## scale(assay_rep, scale = FALSE)                  0.177    
## block                                            0.756    
## ---
## Signif. codes:  
## 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##             (Intr) opp_sz sc=Ts=T s(_s=F
## opp_size     0.000                      
## s(_,c=TRs=T  0.000  0.000               
## s(_,s=FALSE  0.000 -0.100  0.000        
## block        0.000  0.000  0.002   0.000</code></pre>
<p>So we’d probably calculate R using the individual and residual variance simply as:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="5.2-practical-3.html#cb49-1" aria-hidden="true"></a><span class="fl">0.02538</span> <span class="op">/</span><span class="st"> </span>(<span class="fl">0.02538</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.58048</span>)</span></code></pre></div>
<pre><code>## [1] 0.04189087</code></pre>

<div class="rmdcode">
Do you see where I took the numbers ?
</div>
<p>We can use some more fancy coding to extract the estimates and plugged them in a formula to estimate the repeatbility</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="5.2-practical-3.html#cb51-1" aria-hidden="true"></a>v_id &lt;-<span class="st"> </span><span class="kw">VarCorr</span>(m_<span class="dv">3</span>)<span class="op">$</span>ID[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb51-2"><a href="5.2-practical-3.html#cb51-2" aria-hidden="true"></a>v_r &lt;-<span class="st"> </span><span class="kw">attr</span>(<span class="kw">VarCorr</span>(m_<span class="dv">3</span>), <span class="st">&quot;sc&quot;</span>)<span class="op">^</span><span class="dv">2</span></span>
<span id="cb51-3"><a href="5.2-practical-3.html#cb51-3" aria-hidden="true"></a>r_man &lt;-<span class="st"> </span>v_id <span class="op">/</span><span class="st"> </span>(v_id <span class="op">+</span><span class="st"> </span>v_r)</span>
<span id="cb51-4"><a href="5.2-practical-3.html#cb51-4" aria-hidden="true"></a>r_man</span></code></pre></div>
<pre><code>## [1] 0.04188879</code></pre>
<p>Which yields an estimate of approximately R=4%. Strictly speaking we should make clear this a <strong>conditional repeatability</strong> estimate.</p>
<p>Conditional on what you might ask… on the fixed effects in your model. So our best estimate of 4% refers to the proportion of variance in aggressiveness <em>not explained by fixed effects</em> that is explained by individual identity. This isn’t much and still won’t be significant, but illustrates the point that conditional repeatabilities often have a tendency to go up as people explain more of the residual variance by adding fixed effects. This is fine and proper, but can mislead the unwary reader.
It also means that decisions about which fixed effects to include in your model need to be based on how you want to interpret R not just on, for instance, whether fixed effects are deemed significant.</p>
</div>
<div id="a-quick-note-on-uncertainty" class="section level3" number="5.2.7">
<h3><span class="header-section-number">5.2.7</span> A quick note on uncertainty</h3>
<p>Using <code>lmer</code> in the 📦 <code>lme4</code> 📦 there isn’t a really simple way to put some measure of uncertainty (SE or CI) on derived parameters like repeatabilities. This is a bit annoying. Such things are more easily done with other mixed model 📦 like <code>MCMCglmm</code> and <code>asreml</code> which are a bit more specialist. If you are using <code>lmer</code> for models you want to publish then you could look into the 📦 <code>rptR</code> <span class="citation">(Stoffel et al. <a href="#ref-R-rptR" role="doc-biblioref">2019</a>)</span>. This acts as a ‘wrapper’ for <code>lmer</code> models and adds some nice functionality including options to boostrap confidence intervals. Regardless, of how you do it, if you want to put a repeatability in one of your papers as a key result - it really should be accompanied by a measure of uncertainty just like any other effect size estimate.</p>
<p>Here I am estimating the repeatability and using bootstrap to estimate a confidence interval and a probability associated with the repeatability with the <code>rptR</code> 📦. For more information about the use of the package and the theory behind it suggest the excellent paper associated with the package <span class="citation">(Stoffel et al. <a href="#ref-rptR2017" role="doc-biblioref">2017</a>)</span></p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="5.2-practical-3.html#cb53-1" aria-hidden="true"></a>r_rpt &lt;-<span class="st"> </span><span class="kw">rptGaussian</span>(</span>
<span id="cb53-2"><a href="5.2-practical-3.html#cb53-2" aria-hidden="true"></a>  aggression <span class="op">~</span><span class="st"> </span>opp_size <span class="op">+</span><span class="st"> </span>block <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>ID),</span>
<span id="cb53-3"><a href="5.2-practical-3.html#cb53-3" aria-hidden="true"></a>  <span class="dt">grname =</span> <span class="st">&quot;ID&quot;</span>, <span class="dt">data =</span> unicorns</span>
<span id="cb53-4"><a href="5.2-practical-3.html#cb53-4" aria-hidden="true"></a>)</span></code></pre></div>
<pre><code>## Bootstrap Progress:</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="5.2-practical-3.html#cb55-1" aria-hidden="true"></a>r_rpt</span></code></pre></div>
<pre><code>## 
## 
## Repeatability estimation using the lmm method 
## 
## Repeatability for ID
## R  = 0.041
## SE = 0.031
## CI = [0, 0.108]
## P  = 0.0966 [LRT]
##      NA [Permutation]</code></pre>
</div>
<div id="an-easy-way-to-mess-up-your-mixed-models" class="section level3" number="5.2.8">
<h3><span class="header-section-number">5.2.8</span> An easy way to mess up your mixed models</h3>
<p>We will try some more advanced mixed models in a moment to explore plasticity in aggressiveness a bit more. First let’s quickly look for among-individual variance in focal body size. Why not? We have the data handy, everyone says morphological traits are very repeatable and - lets be honest - who wouldn’t like to see a small P value after striking out with aggressiveness.</p>
<p>Include a random effect of ID as before and maybe a fixed effect of block, just to see if the beasties were growing a bit between data collection periods.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="5.2-practical-3.html#cb57-1" aria-hidden="true"></a>lmer_size &lt;-<span class="st"> </span><span class="kw">lmer</span>(body_size <span class="op">~</span><span class="st"> </span>block <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>ID),</span>
<span id="cb57-2"><a href="5.2-practical-3.html#cb57-2" aria-hidden="true"></a>  <span class="dt">data =</span> unicorns</span>
<span id="cb57-3"><a href="5.2-practical-3.html#cb57-3" aria-hidden="true"></a>)</span></code></pre></div>
<p>Summarise and test the random effect.</p>
<div class="exer">
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="5.2-practical-3.html#cb58-1" aria-hidden="true"></a><span class="kw">summary</span>(lmer_size)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML. t-tests use
##   Satterthwaite&#39;s method [lmerModLmerTest]
## Formula: body_size ~ block + (1 | ID)
##    Data: unicorns
## 
## REML criterion at convergence: 3460.7
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -1.80452 -0.71319  0.00718  0.70280  1.81747 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  ID       (Intercept) 936.01   30.594  
##  Residual              34.32    5.858  
## Number of obs: 480, groups:  ID, 80
## 
## Fixed effects:
##             Estimate Std. Error       df t value Pr(&gt;|t|)
## (Intercept) 252.5031     3.4310  79.0000  73.595   &lt;2e-16
## block        -0.1188     0.5348 399.0000  -0.222    0.824
##                
## (Intercept) ***
## block          
## ---
## Signif. codes:  
## 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##       (Intr)
## block 0.000</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="5.2-practical-3.html#cb60-1" aria-hidden="true"></a><span class="kw">ranova</span>(lmer_size)</span></code></pre></div>
<pre><code>## ANOVA-like table for random-effects: Single term deletions
## 
## Model:
## body_size ~ block + (1 | ID)
##          npar  logLik    AIC    LRT Df Pr(&gt;Chisq)    
## &lt;none&gt;      4 -1730.4 3468.7                         
## (1 | ID)    3 -2325.6 4657.1 1190.4  1  &lt; 2.2e-16 ***
## ---
## Signif. codes:  
## 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>

<div class="rmdcode">
<strong>What might you conclude, and why would this be foolish?</strong>
</div>
<div class="exer">
<p>Hopefully you spotted the problem here. You have fed in a data set with 6 records per individual (with 2 sets of 3 identical values per unicorns), when you know size was only measured twice in reality. This means you’d expect to get a (potentially very) upwardly biased estimate of R and a (potentially very) downwardly biased P value when testing among-individual variance.</p>
</div>

<div class="rmdcode">
<strong>How can we do it properly?</strong>
</div>
<div class="exer">
<p>We can prune the data to the two actual observations per unicorns by just selecting the first assay in each block.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="5.2-practical-3.html#cb62-1" aria-hidden="true"></a>unicorns2 &lt;-<span class="st"> </span>unicorns[unicorns<span class="op">$</span>assay_rep <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, ]</span>
<span id="cb62-2"><a href="5.2-practical-3.html#cb62-2" aria-hidden="true"></a></span>
<span id="cb62-3"><a href="5.2-practical-3.html#cb62-3" aria-hidden="true"></a>lmer_size2 &lt;-<span class="st"> </span><span class="kw">lmer</span>(body_size <span class="op">~</span><span class="st"> </span>block <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>ID),</span>
<span id="cb62-4"><a href="5.2-practical-3.html#cb62-4" aria-hidden="true"></a>  <span class="dt">data =</span> unicorns2</span>
<span id="cb62-5"><a href="5.2-practical-3.html#cb62-5" aria-hidden="true"></a>)</span>
<span id="cb62-6"><a href="5.2-practical-3.html#cb62-6" aria-hidden="true"></a><span class="kw">summary</span>(lmer_size2)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML. t-tests use
##   Satterthwaite&#39;s method [lmerModLmerTest]
## Formula: body_size ~ block + (1 | ID)
##    Data: unicorns2
## 
## REML criterion at convergence: 1373.4
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -1.54633 -0.56198  0.01319  0.56094  1.42095 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  ID       (Intercept) 912.84   30.213  
##  Residual              57.78    7.601  
## Number of obs: 160, groups:  ID, 80
## 
## Fixed effects:
##             Estimate Std. Error       df t value Pr(&gt;|t|)
## (Intercept) 252.5031     3.4310  79.0000  73.595   &lt;2e-16
## block        -0.1188     1.2019  79.0000  -0.099    0.922
##                
## (Intercept) ***
## block          
## ---
## Signif. codes:  
## 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##       (Intr)
## block 0.000</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="5.2-practical-3.html#cb64-1" aria-hidden="true"></a><span class="kw">ranova</span>(lmer_size2)</span></code></pre></div>
<pre><code>## ANOVA-like table for random-effects: Single term deletions
## 
## Model:
## body_size ~ block + (1 | ID)
##          npar  logLik    AIC    LRT Df Pr(&gt;Chisq)    
## &lt;none&gt;      4 -686.68 1381.3                         
## (1 | ID)    3 -771.93 1549.9 170.51  1  &lt; 2.2e-16 ***
## ---
## Signif. codes:  
## 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Summarise and test your random effect and you’ll see the qualitative conclusions will actually be very similar using the pruned data set. Of course this won’t generallty but be true, so just be careful. Mixed models are intended to help you model repeated measures data with non-independence, but they won’t get you out of trouble if you mis-represent the true structure of observations on your dependent variable.</p>
</div>
</div>
<div id="happy-mixed-modelling" class="section level3" number="5.2.9">
<h3><span class="header-section-number">5.2.9</span> Happy mixed-modelling</h3>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-34"></span>
<img src="images/unicorn.png" alt="The superb unicorn" width="20%" />
<p class="caption">
Figure 5.6: The superb unicorn
</p>
</div>

</div>
</div>
<!-- </div> -->
<h3>References</h3>
<div id="refs" class="references hanging-indent">
<div id="ref-R-lme4">
<p>Bates, D., M. Maechler, B. Bolker, and S. Walker. 2021. Lme4: Linear mixed-effects models using eigen and s4.</p>
</div>
<div id="ref-R-asreml">
<p>Butler, D. 2021. Asreml: Fits the linear mixed model.</p>
</div>
<div id="ref-R-MCMCglmm">
<p>Hadfield, J. 2022. MCMCglmm: MCMC generalised linear mixed models.</p>
</div>
<div id="ref-MCMCglmm2010">
<p>Hadfield, J. D. 2010. MCMC methods for multi-response generalized linear mixed models: The MCMCglmm R package. Journal of Statistical Software 33:1–22.</p>
</div>
<div id="ref-houslay_avoiding_2017">
<p>Houslay, T. M., and A. J. Wilson. 2017. Avoiding the misuse of BLUP in behavioural ecology. Behavioral Ecology 28:948–952.</p>
</div>
<div id="ref-R-lmerTest">
<p>Kuznetsova, A., P. Bruun Brockhoff, and R. Haubo Bojesen Christensen. 2020. LmerTest: Tests in linear mixed effects models.</p>
</div>
<div id="ref-rptR2017">
<p>Stoffel, M. A., S. Nakagawa, and H. Schielzeth. 2017. RptR: Repeatability estimation and variance decomposition by generalized linear mixed-effects models. Methods in Ecology and Evolution 8:1639???1644.</p>
</div>
<div id="ref-R-rptR">
<p>Stoffel, M., S. Nakagawa, and H. Schielzeth. 2019. RptR: Repeatability estimation for gaussian and non-gaussian data.</p>
</div>
</div>
<script src="js/solution.js"></script>
            </section>

          </div>
        </div>
      </div>
<a href="5.1-lecture-4.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="6-introduction-to-glmm.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/BIO8940-uOttawa/class_book/02_02-intro_lmm.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["BIO8940_book.pdf", "BIO8940_book.epub", "BIO8940_book.mobi"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
